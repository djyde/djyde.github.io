<!DOCTYPE html><html data-saber-ssr><head><meta charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta http-equiv="X-UA-Compatible" content="ie=edge" /><meta data-saber-head="ssr" name="generator" content="Saber v0.11.2"><meta data-saber-head="ssr" name="og:site_name" content="Randy&#x27;s Blog"><meta data-saber-head="ssr" property="title" content="高效的 GraphQL + Ant.Design - Randy&#x27;s Blog"><meta data-saber-head="ssr" property="description" content="&lt;p&gt;在过去的几年，不论是面向内部的系统，还是面向外部的产品，我们都大量地使用了 &lt;a href=&quot;http://ant.design&quot;&gt;Ant.Design&lt;/a&gt; —— 一个基于 React 的 UI 组件库。&lt;/p&gt;
"><meta data-saber-head="ssr" property="og:description" content="&lt;p&gt;在过去的几年，不论是面向内部的系统，还是面向外部的产品，我们都大量地使用了 &lt;a href=&quot;http://ant.design&quot;&gt;Ant.Design&lt;/a&gt; —— 一个基于 React 的 UI 组件库。&lt;/p&gt;
"><meta data-saber-head="ssr" property="twitter:description" content="&lt;p&gt;在过去的几年，不论是面向内部的系统，还是面向外部的产品，我们都大量地使用了 &lt;a href=&quot;http://ant.design&quot;&gt;Ant.Design&lt;/a&gt; —— 一个基于 React 的 UI 组件库。&lt;/p&gt;
"><meta data-saber-head="ssr" property="og:title" content="高效的 GraphQL + Ant.Design - Randy&#x27;s Blog"><meta data-saber-head="ssr" property="og:type" content="article"><meta data-saber-head="ssr" property="article:published_time" content="2018-09-12 11:14"><meta data-saber-head="ssr" property="twitter:title" content="高效的 GraphQL + Ant.Design - Randy&#x27;s Blog"><meta data-saber-head="ssr" property="og:url" content="https://lutaonan.com/blog/effective-graphql-and-antd"><meta data-saber-head="ssr" property="og:image" content="https://gbstatic.djyde.com/assets/Snapseed%203.jpg?x-oss-process=image/auto-orient,1/quality,q_80/bright,-10/resize,w_2560/contrast,-30/interlace,1"><meta data-saber-head="ssr" property="twitter:image" content="https://gbstatic.djyde.com/assets/Snapseed%203.jpg?x-oss-process=image/auto-orient,1/quality,q_80/bright,-10/resize,w_2560/contrast,-30/interlace,1"> <title>高效的 GraphQL + Ant.Design - Randy&#x27;s Blog</title> <link data-saber-head="ssr" rel="stylesheet" href="//ppp.djyde.com/css?family=Noto+Serif+SC"><link rel="stylesheet" href="/_saber/css/styles.2c5e9edc.chunk.css">  </head><body><div id="_saber" data-server-rendered="true"><div><div data-v-12b68786><nav class="bg-black flex text-white item-center font-serif" data-v-5fd162c6 data-v-12b68786><div class="text font-bold mr-4 p-1 pl-4" data-v-5fd162c6><a href="/" class="router-link-active" data-v-5fd162c6>Randy's Blog</a></div> <div class="flex item-center" data-v-5fd162c6><a href="/" class="mr-4 hover:bg-gray-300 hover:text-gray-900 p-1 router-link-active" data-v-5fd162c6>寫作</a></div><div class="flex item-center" data-v-5fd162c6><a href="/readings" class="mr-4 hover:bg-gray-300 hover:text-gray-900 p-1" data-v-5fd162c6>我讀</a></div><div class="flex item-center" data-v-5fd162c6><a href="/music" class="mr-4 hover:bg-gray-300 hover:text-gray-900 p-1" data-v-5fd162c6>音樂</a></div><div class="flex item-center" data-v-5fd162c6><a href="/about" class="mr-4 hover:bg-gray-300 hover:text-gray-900 p-1" data-v-5fd162c6>關於我</a></div></nav> <!----> <div class="post container mx-auto lg:pl-48 lg:pr-48" data-v-12b68786><h1 class="pl-4 pr-4" data-v-12b68786>高效的 GraphQL + Ant.Design</h1> <div class="text-sm text-gray-500 pl-4 pr-4" data-v-12b68786>September 12, 2018</div> <div class="content" data-v-12b68786><p data-v-12b68786>在过去的几年，不论是面向内部的系统，还是面向外部的产品，我们都大量地使用了 <a rel="noopener noreferrer" target="_blank" href="http://ant.design" data-v-12b68786>Ant.Design</a> —— 一个基于 React 的 UI 组件库。</p> <p data-v-12b68786>在做内部系统时，Ant.Design 解决了几乎 60% 的问题。剩下的问题在业务逻辑和代码组织的复杂度。我见过很多内部系统因为滥用状态管理而使代码变得复杂，他们之所以使用状态管理库，并不是因为应用的状态复杂，而是因为需要一个状态树来管理网络请求的状态、接口返回的数据等等这些和接口相关的状态。</p> <p data-v-12b68786>真的需要状态管理库吗？在之前，我没有信心回答这个问题。但在使用了 <a rel="noopener noreferrer" target="_blank" href="https://graphql.org" data-v-12b68786>GraphQL</a> (<a rel="noopener noreferrer" target="_blank" href="https://apollographql.com" data-v-12b68786>Apollo</a>) 后，我确信，在大多数场景，你不再需要状态管理。</p> <p data-v-12b68786>这篇文章的目标就是让你认识 GraphQL / Apollo, 以及在 Ant.Design 里如何高效地使用他。你不必担心 GraphQL 会给你带来负担，学习和使用 GraphQL 都是令人愉快的过程。你会发现以往让你感到厌烦的需要重复编写的逻辑，可以不必再写了。</p> <blockquote data-v-12b68786><p data-v-12b68786><em data-v-12b68786>Keep frontend code lean and straight.</em>
—— Randy Lu</p></blockquote> <p data-v-12b68786><em data-v-12b68786>本文的前端代码在 CodeSandbox <a rel="noopener noreferrer" target="_blank" href="https://codesandbox.io/s/pwmrnjz2km" data-v-12b68786>https://codesandbox.io/s/pwmrnjz2km</a></em></p> <p data-v-12b68786><em data-v-12b68786>本文使用大量 ES6+ 特性，请在阅读本文前熟悉 ES6+ 语法。</em></p> <h2 id="什么是-graphql" data-v-12b68786>什么是 GraphQL</h2> <p data-v-12b68786><a rel="noopener noreferrer" target="_blank" href="https://graphql.org" data-v-12b68786>GraphQL</a> 是一个查询语言，和 SQL 是同等概念的。</p> <p data-v-12b68786>举个例子，在 RESTful 的场景里，我们查询一个资源是通过命令式地进行网络请求：</p> <div class="saber-highlight" data-lang="javascript" data-v-12b68786><pre class="saber-highlight-code language-javascript" data-v-12b68786><code class="language-javascript" data-v-12b68786><span class="token keyword" data-v-12b68786>const</span> posts <span class="token operator" data-v-12b68786>=</span> <span class="token keyword" data-v-12b68786>await</span> <span class="token function" data-v-12b68786>fetch</span><span class="token punctuation" data-v-12b68786>(</span><span class="token string" data-v-12b68786>'/api/v1/posts'</span><span class="token punctuation" data-v-12b68786>)</span></code></pre></div><p data-v-12b68786>而使用 GraphQL, 是声明式地查询：</p> <div class="saber-highlight" data-lang="gql" data-v-12b68786><pre class="saber-highlight-code language-gql" data-v-12b68786><code class="language-gql" data-v-12b68786>query {
  posts {
  	title, body, id
  }
}</code></pre></div><p data-v-12b68786>写数据时，命令式地 POST:</p> <div class="saber-highlight" data-lang="javascript" data-v-12b68786><pre class="saber-highlight-code language-javascript" data-v-12b68786><code class="language-javascript" data-v-12b68786><span class="token keyword" data-v-12b68786>const</span> response <span class="token operator" data-v-12b68786>=</span> <span class="token keyword" data-v-12b68786>await</span> <span class="token function" data-v-12b68786>fetch</span><span class="token punctuation" data-v-12b68786>(</span><span class="token string" data-v-12b68786>'/api/v1/posts'</span><span class="token punctuation" data-v-12b68786>,</span> <span class="token punctuation" data-v-12b68786>{</span> method<span class="token punctuation" data-v-12b68786>:</span> <span class="token string" data-v-12b68786>'POST'</span><span class="token punctuation" data-v-12b68786>,</span> body<span class="token punctuation" data-v-12b68786>:</span> <span class="token punctuation" data-v-12b68786>{</span> title<span class="token punctuation" data-v-12b68786>:</span> <span class="token string" data-v-12b68786>&quot;foo&quot;</span><span class="token punctuation" data-v-12b68786>,</span> body<span class="token punctuation" data-v-12b68786>:</span> <span class="token string" data-v-12b68786>&quot;content&quot;</span> <span class="token punctuation" data-v-12b68786>}</span> <span class="token punctuation" data-v-12b68786>}</span> <span class="token punctuation" data-v-12b68786>)</span></code></pre></div><p data-v-12b68786>使用 GraphQL, 声明式地触发 mutation:</p> <div class="saber-highlight" data-lang="gql" data-v-12b68786><pre class="saber-highlight-code language-gql" data-v-12b68786><code class="language-gql" data-v-12b68786>mutation {
  createPost(post: { title: &quot;foo&quot;, body: &quot;content&quot; })
}</code></pre></div><p data-v-12b68786>你也许会疑惑，这些 GraphQL 语句怎么执行？其实这些语句需要被转换，而转换的工具就是接下来要介绍的 Apollo.</p> <h2 id="什么是-apollo" data-v-12b68786>什么是 Apollo</h2> <p data-v-12b68786><a rel="noopener noreferrer" target="_blank" href="https://apollographql.com" data-v-12b68786>Apollo</a> 是一系列的 GraphQL 工具链，从客户端（不同的前端框架）到服务器端都提供了使用和搭建 GraphQL 的工具。</p> <p data-v-12b68786>下面会通过一个简单的例子，让你从前端到服务器端对 GraphQL 有个初步的了解。</p> <p data-v-12b68786>想象有这样一个需求：用表格展示一组数据。</p> <p data-v-12b68786><img src="https://gbstatic.djyde.com/blog/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f6c61726b2f302f323031382f706e672f363036382f313533363232373433323639312d62643730653065372d616136312d343831362d383539352d6661653162616436613932622e706e67.png" alt="一个带数据的表格" data-v-12b68786></p> <p data-v-12b68786>后端告诉你，有如下接口：</p> <ul data-v-12b68786><li data-v-12b68786><a rel="noopener noreferrer" target="_blank" href="https://jsonplaceholder.typicode.com/posts" data-v-12b68786>https://jsonplaceholder.typicode.com/posts</a></li></ul> <p data-v-12b68786>这个接口可以获取所有 <code data-v-12b68786>Post</code>, 返回的格式如下：</p> <div class="saber-highlight" data-lang="typescript" data-v-12b68786><pre class="saber-highlight-code language-typescript" data-v-12b68786><code class="language-typescript" data-v-12b68786><span class="token keyword" data-v-12b68786>interface</span> <span class="token class-name" data-v-12b68786>Post</span> <span class="token punctuation" data-v-12b68786>{</span>
  userId<span class="token punctuation" data-v-12b68786>:</span> <span class="token builtin" data-v-12b68786>number</span><span class="token punctuation" data-v-12b68786>,</span>
  id<span class="token punctuation" data-v-12b68786>:</span> <span class="token builtin" data-v-12b68786>number</span><span class="token punctuation" data-v-12b68786>,</span>
  title<span class="token punctuation" data-v-12b68786>:</span> <span class="token builtin" data-v-12b68786>string</span><span class="token punctuation" data-v-12b68786>,</span>
  body<span class="token punctuation" data-v-12b68786>:</span> <span class="token builtin" data-v-12b68786>string</span>
<span class="token punctuation" data-v-12b68786>}</span></code></pre></div><p data-v-12b68786>第一步我们需要搭建一个 GraphQL 服务器。</p> <h3 id="搭建一个-graphql-服务器" data-v-12b68786>搭建一个 GraphQL 服务器</h3> <p data-v-12b68786>搭建一个 GraphQL 服务器不难，Apollo Server 对主流的 Node.js Web 框架都有封装，本文不赘述如何搭建一个 GraphQL 服务器，只介绍 GraphQL 后端编写的一些概念。</p> <p data-v-12b68786>用 Apollo Server 编写 GraphQL 服务器有两个主要概念，<code data-v-12b68786>typeDefs</code> 和 <code data-v-12b68786>resolvers</code>.</p> <p data-v-12b68786><code data-v-12b68786>typeDefs</code> 指的是类型定义。GraphQL 是一个有类型系统的查询语言，因此在编写 GraphQL 服务时，要先对查询的数据类型进行定义。</p> <p data-v-12b68786>我们已经知道 <code data-v-12b68786>Post</code> 的数据类型是怎样的，就可以编写 <code data-v-12b68786>Post</code> 的类型定义：</p> <div class="saber-highlight" data-lang="javascript" data-v-12b68786><pre class="saber-highlight-code language-javascript" data-v-12b68786><code class="language-javascript" data-v-12b68786><span class="token keyword" data-v-12b68786>import</span> gql <span class="token keyword" data-v-12b68786>from</span> <span class="token string" data-v-12b68786>'graphql-tag'</span>

<span class="token keyword" data-v-12b68786>const</span> typeDefs <span class="token operator" data-v-12b68786>=</span> gql<span class="token template-string" data-v-12b68786><span class="token template-punctuation string" data-v-12b68786>`</span><span class="token string" data-v-12b68786>
  type Post {
    userId: Int!
    id: Int!
    title: String!
    body: String!
  }
</span><span class="token template-punctuation string" data-v-12b68786>`</span></span></code></pre></div><p data-v-12b68786>另外，我们需要对 <code data-v-12b68786>Query</code> 进行定义，来定义有哪些查询操作：</p> <div class="saber-highlight" data-lang="diff" data-v-12b68786><pre class="saber-highlight-code language-diff" data-v-12b68786><code class="language-diff" data-v-12b68786>import gql from 'graphql-tag'

const typeDefs = gql`
<span class="token unchanged" data-v-12b68786>  type Post {
    userId: Int!
    id: Int!
    title: String!
    body: String!
  }
</span>
<span class="token inserted-sign inserted" data-v-12b68786>+ type Query {
+   posts: [Post]
+ }
</span>`</code></pre></div><blockquote data-v-12b68786><p data-v-12b68786>在 <a rel="noopener noreferrer" target="_blank" href="https://graphql.org/learn/schema/" data-v-12b68786>官方文档</a> 详细了解 GraphQL 的类型系统。</p></blockquote> <p data-v-12b68786>这样一来，外界就可以通过</p> <div class="saber-highlight" data-lang="javascript" data-v-12b68786><pre class="saber-highlight-code language-javascript" data-v-12b68786><code class="language-javascript" data-v-12b68786>query <span class="token punctuation" data-v-12b68786>{</span>
  posts <span class="token punctuation" data-v-12b68786>{</span>
    id<span class="token punctuation" data-v-12b68786>,</span> title
  <span class="token punctuation" data-v-12b68786>}</span>
<span class="token punctuation" data-v-12b68786>}</span></code></pre></div><p data-v-12b68786>这样的查询语句查询到 <code data-v-12b68786>posts</code> 了。</p> <p data-v-12b68786>光是类型定义还不够，因为服务器还不知道「查询 posts」这个操作到底应该做什么。这里就是 <code data-v-12b68786>resolvers</code> 要做的事了。在 <code data-v-12b68786>resolvers</code> 里定义查询的实际行为：</p> <div class="saber-highlight" data-lang="javascript" data-v-12b68786><pre class="saber-highlight-code language-javascript" data-v-12b68786><code class="language-javascript" data-v-12b68786><span class="token keyword" data-v-12b68786>const</span> resolvers <span class="token operator" data-v-12b68786>=</span> <span class="token punctuation" data-v-12b68786>{</span>
  Query<span class="token punctuation" data-v-12b68786>:</span> <span class="token punctuation" data-v-12b68786>{</span>
    <span class="token keyword" data-v-12b68786>async</span> <span class="token function" data-v-12b68786>posts</span><span class="token punctuation" data-v-12b68786>(</span><span class="token punctuation" data-v-12b68786>)</span> <span class="token punctuation" data-v-12b68786>{</span>
      <span class="token keyword" data-v-12b68786>const</span> res <span class="token operator" data-v-12b68786>=</span> <span class="token keyword" data-v-12b68786>await</span> <span class="token function" data-v-12b68786>fetch</span><span class="token punctuation" data-v-12b68786>(</span><span class="token string" data-v-12b68786>'https://jsonplaceholder.typicode.com/posts'</span><span class="token punctuation" data-v-12b68786>)</span>
      <span class="token keyword" data-v-12b68786>return</span> res<span class="token punctuation" data-v-12b68786>.</span><span class="token function" data-v-12b68786>json</span><span class="token punctuation" data-v-12b68786>(</span><span class="token punctuation" data-v-12b68786>)</span>
    <span class="token punctuation" data-v-12b68786>}</span>
  <span class="token punctuation" data-v-12b68786>}</span>
<span class="token punctuation" data-v-12b68786>}</span></code></pre></div><blockquote data-v-12b68786><p data-v-12b68786>在 <a rel="noopener noreferrer" target="_blank" href="https://www.apollographql.com/docs/apollo-server/v2/essentials/data.html" data-v-12b68786>官方文档</a> 详细了解 <code data-v-12b68786>resolvers</code> 的用法。</p></blockquote> <p data-v-12b68786>最后，通过 Apollo Server 把 <code data-v-12b68786>typeDefs</code> 和 <code data-v-12b68786>resolvers</code> 连起来，一个 GraphQL 服务器就成功搭起来了。</p> <div class="saber-highlight" data-lang="javascript" data-v-12b68786><pre class="saber-highlight-code language-javascript" data-v-12b68786><code class="language-javascript" data-v-12b68786><span class="token keyword" data-v-12b68786>const</span> server <span class="token operator" data-v-12b68786>=</span> <span class="token keyword" data-v-12b68786>new</span> <span class="token class-name" data-v-12b68786>ApolloServer</span><span class="token punctuation" data-v-12b68786>(</span><span class="token punctuation" data-v-12b68786>{</span> typeDefs<span class="token punctuation" data-v-12b68786>,</span> resolvers <span class="token punctuation" data-v-12b68786>}</span><span class="token punctuation" data-v-12b68786>)</span>

server<span class="token punctuation" data-v-12b68786>.</span><span class="token function" data-v-12b68786>listen</span><span class="token punctuation" data-v-12b68786>(</span><span class="token punctuation" data-v-12b68786>)</span><span class="token punctuation" data-v-12b68786>.</span><span class="token function" data-v-12b68786>then</span><span class="token punctuation" data-v-12b68786>(</span><span class="token punctuation" data-v-12b68786>(</span><span class="token parameter" data-v-12b68786><span class="token punctuation" data-v-12b68786>{</span> url <span class="token punctuation" data-v-12b68786>}</span></span><span class="token punctuation" data-v-12b68786>)</span> <span class="token operator" data-v-12b68786>=&gt;</span> <span class="token punctuation" data-v-12b68786>{</span>
  console<span class="token punctuation" data-v-12b68786>.</span><span class="token function" data-v-12b68786>log</span><span class="token punctuation" data-v-12b68786>(</span><span class="token template-string" data-v-12b68786><span class="token template-punctuation string" data-v-12b68786>`</span><span class="token string" data-v-12b68786>Ready at </span><span class="token interpolation" data-v-12b68786><span class="token interpolation-punctuation punctuation" data-v-12b68786>${</span>url<span class="token interpolation-punctuation punctuation" data-v-12b68786>}</span></span><span class="token template-punctuation string" data-v-12b68786>`</span></span><span class="token punctuation" data-v-12b68786>)</span>
<span class="token punctuation" data-v-12b68786>}</span><span class="token punctuation" data-v-12b68786>)</span></code></pre></div><blockquote data-v-12b68786><p data-v-12b68786>我在本文用到的 GraphQL 服务器源码在 <a rel="noopener noreferrer" target="_blank" href="https://github.com/djyde/graphql-jsonplaceholder" data-v-12b68786>https://github.com/djyde/graphql-jsonplaceholder</a> , 通过 <a rel="noopener noreferrer" target="_blank" href="https://graphql-jsonplaceholder.now.sh" data-v-12b68786>https://graphql-jsonplaceholder.now.sh</a> 可以访问 Playground.</p></blockquote> <blockquote data-v-12b68786><p data-v-12b68786>你也可以通过 <a rel="noopener noreferrer" target="_blank" href="https://launchpad.graphql.com/" data-v-12b68786>Apollo Launchpad</a> 在线上快速搭建一个测试用的 GraphQL 服务.</p></blockquote> <h3 id="最简单的前端查询" data-v-12b68786>最简单的前端查询</h3> <p data-v-12b68786>有了 GraphQL 服务后，我们开始编写前端组件。首先要创建一个 <code data-v-12b68786>ApolloClient</code> 实例。最简单的方法是通过 <code data-v-12b68786>apollo-boost</code>:</p> <div class="saber-highlight" data-lang="typescript" data-v-12b68786><pre class="saber-highlight-code language-typescript" data-v-12b68786><code class="language-typescript" data-v-12b68786><span class="token keyword" data-v-12b68786>import</span> ApolloClient <span class="token keyword" data-v-12b68786>from</span> <span class="token string" data-v-12b68786>&quot;apollo-boost&quot;</span><span class="token punctuation" data-v-12b68786>;</span>

<span class="token keyword" data-v-12b68786>const</span> apolloClient <span class="token operator" data-v-12b68786>=</span> <span class="token keyword" data-v-12b68786>new</span> <span class="token class-name" data-v-12b68786>ApolloClient</span><span class="token punctuation" data-v-12b68786>(</span><span class="token punctuation" data-v-12b68786>{</span>
  <span class="token comment" data-v-12b68786>// GraphQL 服务器地址</span>
  uri<span class="token punctuation" data-v-12b68786>:</span> <span class="token string" data-v-12b68786>&quot;https://graphql-jsonplaceholder.now.sh&quot;</span>
<span class="token punctuation" data-v-12b68786>}</span><span class="token punctuation" data-v-12b68786>)</span><span class="token punctuation" data-v-12b68786>;</span></code></pre></div><p data-v-12b68786><code data-v-12b68786>ApolloClient</code> 可以命令式地进行查询：</p> <div class="saber-highlight" data-lang="javascript" data-v-12b68786><pre class="saber-highlight-code language-javascript" data-v-12b68786><code class="language-javascript" data-v-12b68786><span class="token keyword" data-v-12b68786>const</span> result <span class="token operator" data-v-12b68786>=</span> <span class="token keyword" data-v-12b68786>await</span> apolloClient<span class="token punctuation" data-v-12b68786>.</span><span class="token function" data-v-12b68786>query</span><span class="token punctuation" data-v-12b68786>(</span><span class="token punctuation" data-v-12b68786>{</span>
  query<span class="token punctuation" data-v-12b68786>:</span> gql<span class="token template-string" data-v-12b68786><span class="token template-punctuation string" data-v-12b68786>`</span><span class="token string" data-v-12b68786>
    query {
      posts {
        id, title, body
      }
    }
  </span><span class="token template-punctuation string" data-v-12b68786>`</span></span>
<span class="token punctuation" data-v-12b68786>}</span><span class="token punctuation" data-v-12b68786>)</span></code></pre></div><p data-v-12b68786>不过，更高效的做法是用 <code data-v-12b68786>&lt;Query /&gt;</code> 和 <code data-v-12b68786>&lt;Mutation /&gt;</code> 组件进行声明式的查询。因为它们用了 <a rel="noopener noreferrer" target="_blank" href="https://medium.com/merrickchristensen/function-as-child-components-5f3920a9ace9" data-v-12b68786>Function as Child Components<br data-v-12b68786></a> 的模式，把 <code data-v-12b68786>loading</code> 状态，返回的数据 <code data-v-12b68786>data</code> 都通过参数传递。<strong data-v-12b68786>你不需要手动去管理请求的状态</strong>。</p> <div class="saber-highlight" data-lang="javascript" data-v-12b68786><pre class="saber-highlight-code language-javascript" data-v-12b68786><code class="language-javascript" data-v-12b68786><span class="token keyword" data-v-12b68786>import</span> <span class="token punctuation" data-v-12b68786>{</span> Query<span class="token punctuation" data-v-12b68786>,</span> ApolloProvider <span class="token punctuation" data-v-12b68786>}</span> <span class="token keyword" data-v-12b68786>from</span> <span class="token string" data-v-12b68786>'react-apollo'</span>
<span class="token keyword" data-v-12b68786>import</span> gql <span class="token keyword" data-v-12b68786>from</span> <span class="token string" data-v-12b68786>'graphql-tag'</span>
<span class="token keyword" data-v-12b68786>import</span> <span class="token punctuation" data-v-12b68786>{</span> Table <span class="token punctuation" data-v-12b68786>}</span> <span class="token keyword" data-v-12b68786>from</span> <span class="token string" data-v-12b68786>'antd'</span>

<span class="token keyword" data-v-12b68786>const</span> <span class="token constant" data-v-12b68786>GET_POSTS</span> <span class="token operator" data-v-12b68786>=</span> gql<span class="token template-string" data-v-12b68786><span class="token template-punctuation string" data-v-12b68786>`</span><span class="token string" data-v-12b68786>
  query GetPosts {
    posts {
      id, title
    }
  }
</span><span class="token template-punctuation string" data-v-12b68786>`</span></span>

<span class="token keyword" data-v-12b68786>const</span> <span class="token function-variable function" data-v-12b68786>App</span> <span class="token operator" data-v-12b68786>=</span> <span class="token punctuation" data-v-12b68786>(</span><span class="token punctuation" data-v-12b68786>)</span> <span class="token operator" data-v-12b68786>=&gt;</span> <span class="token punctuation" data-v-12b68786>{</span>
  <span class="token keyword" data-v-12b68786>return</span> <span class="token punctuation" data-v-12b68786>(</span>
    <span class="token operator" data-v-12b68786>&lt;</span>Query
      query<span class="token operator" data-v-12b68786>=</span><span class="token punctuation" data-v-12b68786>{</span><span class="token constant" data-v-12b68786>GET_POSTS</span><span class="token punctuation" data-v-12b68786>}</span>
    <span class="token operator" data-v-12b68786>&gt;</span>
      <span class="token punctuation" data-v-12b68786>{</span><span class="token punctuation" data-v-12b68786>(</span><span class="token parameter" data-v-12b68786><span class="token punctuation" data-v-12b68786>{</span> loading<span class="token punctuation" data-v-12b68786>,</span> data <span class="token punctuation" data-v-12b68786>}</span></span><span class="token punctuation" data-v-12b68786>)</span> <span class="token operator" data-v-12b68786>=&gt;</span> <span class="token punctuation" data-v-12b68786>{</span>
        <span class="token keyword" data-v-12b68786>const</span> columns <span class="token operator" data-v-12b68786>=</span> <span class="token punctuation" data-v-12b68786>[</span>
          <span class="token punctuation" data-v-12b68786>{</span>
            title<span class="token punctuation" data-v-12b68786>:</span> <span class="token string" data-v-12b68786>&quot;ID&quot;</span><span class="token punctuation" data-v-12b68786>,</span>
            dataIndex<span class="token punctuation" data-v-12b68786>:</span> <span class="token string" data-v-12b68786>&quot;id&quot;</span>
          <span class="token punctuation" data-v-12b68786>}</span><span class="token punctuation" data-v-12b68786>,</span>
          <span class="token punctuation" data-v-12b68786>{</span> title<span class="token punctuation" data-v-12b68786>:</span> <span class="token string" data-v-12b68786>&quot;Title&quot;</span><span class="token punctuation" data-v-12b68786>,</span> dataIndex<span class="token punctuation" data-v-12b68786>:</span> <span class="token string" data-v-12b68786>&quot;title&quot;</span> <span class="token punctuation" data-v-12b68786>}</span>
        <span class="token punctuation" data-v-12b68786>]</span>

        <span class="token keyword" data-v-12b68786>const</span> dataSource <span class="token operator" data-v-12b68786>=</span> data<span class="token punctuation" data-v-12b68786>.</span>posts <span class="token operator" data-v-12b68786>||</span> <span class="token punctuation" data-v-12b68786>[</span><span class="token punctuation" data-v-12b68786>]</span>

        <span class="token keyword" data-v-12b68786>return</span> <span class="token punctuation" data-v-12b68786>(</span>
          <span class="token operator" data-v-12b68786>&lt;</span>Table
            size<span class="token operator" data-v-12b68786>=</span><span class="token string" data-v-12b68786>&quot;small&quot;</span>
            loading<span class="token operator" data-v-12b68786>=</span><span class="token punctuation" data-v-12b68786>{</span>loading<span class="token punctuation" data-v-12b68786>}</span>
            dataSource<span class="token operator" data-v-12b68786>=</span><span class="token punctuation" data-v-12b68786>{</span>dataSource<span class="token punctuation" data-v-12b68786>}</span>
            columns<span class="token operator" data-v-12b68786>=</span><span class="token punctuation" data-v-12b68786>{</span>columns<span class="token punctuation" data-v-12b68786>}</span>
          <span class="token operator" data-v-12b68786>/</span><span class="token operator" data-v-12b68786>&gt;</span>
        <span class="token punctuation" data-v-12b68786>)</span><span class="token punctuation" data-v-12b68786>;</span>
      <span class="token punctuation" data-v-12b68786>}</span><span class="token punctuation" data-v-12b68786>}</span>
    <span class="token operator" data-v-12b68786>&lt;</span><span class="token operator" data-v-12b68786>/</span>Query<span class="token operator" data-v-12b68786>&gt;</span>
  <span class="token punctuation" data-v-12b68786>)</span>
<span class="token punctuation" data-v-12b68786>}</span>

<span class="token keyword" data-v-12b68786>export</span> <span class="token keyword" data-v-12b68786>default</span> <span class="token punctuation" data-v-12b68786>(</span><span class="token punctuation" data-v-12b68786>)</span> <span class="token operator" data-v-12b68786>=&gt;</span> <span class="token punctuation" data-v-12b68786>{</span>
  <span class="token keyword" data-v-12b68786>return</span> <span class="token punctuation" data-v-12b68786>(</span>
    <span class="token operator" data-v-12b68786>&lt;</span>ApolloProvider client<span class="token operator" data-v-12b68786>=</span><span class="token punctuation" data-v-12b68786>{</span>apolloClient<span class="token punctuation" data-v-12b68786>}</span><span class="token operator" data-v-12b68786>&gt;</span>
      <span class="token operator" data-v-12b68786>&lt;</span>App <span class="token operator" data-v-12b68786>/</span><span class="token operator" data-v-12b68786>&gt;</span>
    <span class="token operator" data-v-12b68786>&lt;</span><span class="token operator" data-v-12b68786>/</span>ApolloProvider<span class="token operator" data-v-12b68786>&gt;</span>
  <span class="token punctuation" data-v-12b68786>)</span>
<span class="token punctuation" data-v-12b68786>}</span></code></pre></div><p data-v-12b68786><a rel="noopener noreferrer" target="_blank" href="https://codesandbox.io/s/pwmrnjz2km?initialpath=%2Ftable&amp;module=%2Fchapters%2FTable%2Findex.tsx" data-v-12b68786><img src="https://codesandbox.io/static/img/play-codesandbox.svg#alt=Edit%20effective-apollo-antd" alt="" data-v-12b68786></a></p> <blockquote data-v-12b68786><p data-v-12b68786><code data-v-12b68786>&lt;ApolloProvider /&gt;</code> 的作用是向所有子组件里的 <code data-v-12b68786>&lt;Query /&gt;</code> 和 <code data-v-12b68786>&lt;Mutation /&gt;</code>  传递 <code data-v-12b68786>ApolloClient</code> 实例.</p></blockquote> <h2 id="进阶实例" data-v-12b68786>进阶实例</h2> <h3 id="查询参数" data-v-12b68786>查询参数</h3> <p data-v-12b68786>我们希望通过一个下拉框 <code data-v-12b68786>&lt;Select /&gt;</code> 选择需要获取的 Post 数量：</p> <p data-v-12b68786><img src="https://gbstatic.djyde.com/blog/68747470733a2f2f7773322e73696e61696d672e636e2f6c617267652f30303639525654646779316676356d3937397332376733306c6d3067306176662e676966.gif" alt="带下拉框的表格" data-v-12b68786></p> <p data-v-12b68786>我们可以让 <code data-v-12b68786>posts</code> 查询接受一个 <code data-v-12b68786>limit</code> 参数：</p> <div class="saber-highlight" data-lang="diff" data-v-12b68786><pre class="saber-highlight-code language-diff" data-v-12b68786><code class="language-diff" data-v-12b68786>import gql from 'graphql-tag'

const typeDefs = gql`
<span class="token unchanged" data-v-12b68786>  type Post {
    userId: Int!
    id: Int!
    title: String!
    body: String!
  }
</span>
<span class="token unchanged" data-v-12b68786>  type Query {
</span><span class="token inserted-sign inserted" data-v-12b68786>+   posts(limit: Int): [Post]
</span><span class="token unchanged" data-v-12b68786>  }
</span>`</code></pre></div><p data-v-12b68786>然后在 <code data-v-12b68786>resolvers</code> 里拿到参数，进行处理：</p> <div class="saber-highlight" data-lang="javascript" data-v-12b68786><pre class="saber-highlight-code language-javascript" data-v-12b68786><code class="language-javascript" data-v-12b68786><span class="token keyword" data-v-12b68786>const</span> resolvers <span class="token operator" data-v-12b68786>=</span> <span class="token punctuation" data-v-12b68786>{</span>
  Query<span class="token punctuation" data-v-12b68786>:</span> <span class="token punctuation" data-v-12b68786>{</span>
    <span class="token keyword" data-v-12b68786>async</span> <span class="token function" data-v-12b68786>posts</span><span class="token punctuation" data-v-12b68786>(</span><span class="token parameter" data-v-12b68786>root<span class="token punctuation" data-v-12b68786>,</span> args</span><span class="token punctuation" data-v-12b68786>)</span> <span class="token punctuation" data-v-12b68786>{</span>
      <span class="token comment" data-v-12b68786>// 每个 resolver 的第二个参数就是查询参数</span>
      <span class="token keyword" data-v-12b68786>const</span> <span class="token punctuation" data-v-12b68786>{</span> limit <span class="token punctuation" data-v-12b68786>}</span> <span class="token operator" data-v-12b68786>=</span> args
      <span class="token keyword" data-v-12b68786>const</span> res <span class="token operator" data-v-12b68786>=</span> <span class="token keyword" data-v-12b68786>await</span> axios<span class="token punctuation" data-v-12b68786>.</span><span class="token function" data-v-12b68786>get</span><span class="token punctuation" data-v-12b68786>(</span><span class="token string" data-v-12b68786>'https://jsonplaceholder.typicode.com/posts'</span><span class="token punctuation" data-v-12b68786>,</span> <span class="token punctuation" data-v-12b68786>{</span>
        params<span class="token punctuation" data-v-12b68786>:</span> <span class="token punctuation" data-v-12b68786>{</span>
          _limit<span class="token punctuation" data-v-12b68786>:</span> limit
        <span class="token punctuation" data-v-12b68786>}</span>
      <span class="token punctuation" data-v-12b68786>}</span><span class="token punctuation" data-v-12b68786>)</span>
      <span class="token keyword" data-v-12b68786>return</span> res<span class="token punctuation" data-v-12b68786>.</span><span class="token function" data-v-12b68786>json</span><span class="token punctuation" data-v-12b68786>(</span><span class="token punctuation" data-v-12b68786>)</span>
    <span class="token punctuation" data-v-12b68786>}</span>
  <span class="token punctuation" data-v-12b68786>}</span>
<span class="token punctuation" data-v-12b68786>}</span></code></pre></div><p data-v-12b68786>在前端，<code data-v-12b68786>&lt;Query /&gt;</code> 的 <code data-v-12b68786>variables</code> props 可以传递参数：</p> <div class="saber-highlight" data-lang="javascript" data-v-12b68786><pre class="saber-highlight-code language-javascript" data-v-12b68786><code class="language-javascript" data-v-12b68786><span class="token keyword" data-v-12b68786>import</span> <span class="token operator" data-v-12b68786>*</span> <span class="token keyword" data-v-12b68786>as</span> React <span class="token keyword" data-v-12b68786>from</span> <span class="token string" data-v-12b68786>&quot;react&quot;</span><span class="token punctuation" data-v-12b68786>;</span>

<span class="token keyword" data-v-12b68786>import</span> <span class="token punctuation" data-v-12b68786>{</span> Table<span class="token punctuation" data-v-12b68786>,</span> Select <span class="token punctuation" data-v-12b68786>}</span> <span class="token keyword" data-v-12b68786>from</span> <span class="token string" data-v-12b68786>&quot;antd&quot;</span><span class="token punctuation" data-v-12b68786>;</span>

<span class="token keyword" data-v-12b68786>import</span> <span class="token punctuation" data-v-12b68786>{</span> Query <span class="token punctuation" data-v-12b68786>}</span> <span class="token keyword" data-v-12b68786>from</span> <span class="token string" data-v-12b68786>&quot;react-apollo&quot;</span><span class="token punctuation" data-v-12b68786>;</span>
<span class="token keyword" data-v-12b68786>import</span> gql <span class="token keyword" data-v-12b68786>from</span> <span class="token string" data-v-12b68786>&quot;graphql-tag&quot;</span><span class="token punctuation" data-v-12b68786>;</span>

<span class="token keyword" data-v-12b68786>const</span> <span class="token constant" data-v-12b68786>GET_POSTS</span> <span class="token operator" data-v-12b68786>=</span> gql<span class="token template-string" data-v-12b68786><span class="token template-punctuation string" data-v-12b68786>`</span><span class="token string" data-v-12b68786>
  query GetPosts($limit: Int) {
    posts(limit: $limit) {
      id, title
    }
  }
</span><span class="token template-punctuation string" data-v-12b68786>`</span></span>

<span class="token keyword" data-v-12b68786>export</span> <span class="token keyword" data-v-12b68786>default</span> <span class="token keyword" data-v-12b68786>class</span> <span class="token class-name" data-v-12b68786>Limit</span> <span class="token keyword" data-v-12b68786>extends</span> <span class="token class-name" data-v-12b68786>React<span class="token punctuation" data-v-12b68786>.</span>Component</span> <span class="token punctuation" data-v-12b68786>{</span>
  state <span class="token operator" data-v-12b68786>=</span> <span class="token punctuation" data-v-12b68786>{</span>
    limit<span class="token punctuation" data-v-12b68786>:</span> <span class="token number" data-v-12b68786>5</span>
  <span class="token punctuation" data-v-12b68786>}</span><span class="token punctuation" data-v-12b68786>;</span>

  <span class="token function-variable function" data-v-12b68786>onChangeLimit</span> <span class="token operator" data-v-12b68786>=</span> <span class="token parameter" data-v-12b68786>limit</span> <span class="token operator" data-v-12b68786>=&gt;</span> <span class="token punctuation" data-v-12b68786>{</span>
    <span class="token keyword" data-v-12b68786>this</span><span class="token punctuation" data-v-12b68786>.</span><span class="token function" data-v-12b68786>setState</span><span class="token punctuation" data-v-12b68786>(</span><span class="token punctuation" data-v-12b68786>{</span> limit <span class="token punctuation" data-v-12b68786>}</span><span class="token punctuation" data-v-12b68786>)</span><span class="token punctuation" data-v-12b68786>;</span>
  <span class="token punctuation" data-v-12b68786>}</span><span class="token punctuation" data-v-12b68786>;</span>

  <span class="token function" data-v-12b68786>render</span><span class="token punctuation" data-v-12b68786>(</span><span class="token punctuation" data-v-12b68786>)</span> <span class="token punctuation" data-v-12b68786>{</span>
    <span class="token keyword" data-v-12b68786>return</span> <span class="token punctuation" data-v-12b68786>(</span>
      <span class="token operator" data-v-12b68786>&lt;</span>div style<span class="token operator" data-v-12b68786>=</span><span class="token punctuation" data-v-12b68786>{</span><span class="token punctuation" data-v-12b68786>{</span> padding<span class="token punctuation" data-v-12b68786>:</span> <span class="token string" data-v-12b68786>&quot;2rem&quot;</span> <span class="token punctuation" data-v-12b68786>}</span><span class="token punctuation" data-v-12b68786>}</span><span class="token operator" data-v-12b68786>&gt;</span>
        <span class="token operator" data-v-12b68786>&lt;</span>Query
          query<span class="token operator" data-v-12b68786>=</span><span class="token punctuation" data-v-12b68786>{</span><span class="token constant" data-v-12b68786>GET_POSTS</span><span class="token punctuation" data-v-12b68786>}</span>
          variables<span class="token operator" data-v-12b68786>=</span><span class="token punctuation" data-v-12b68786>{</span><span class="token punctuation" data-v-12b68786>{</span> limit<span class="token punctuation" data-v-12b68786>:</span> <span class="token keyword" data-v-12b68786>this</span><span class="token punctuation" data-v-12b68786>.</span>state<span class="token punctuation" data-v-12b68786>.</span>limit <span class="token punctuation" data-v-12b68786>}</span><span class="token punctuation" data-v-12b68786>}</span>
        <span class="token operator" data-v-12b68786>&gt;</span>
          <span class="token punctuation" data-v-12b68786>{</span><span class="token punctuation" data-v-12b68786>(</span><span class="token parameter" data-v-12b68786><span class="token punctuation" data-v-12b68786>{</span> loading<span class="token punctuation" data-v-12b68786>,</span> data <span class="token punctuation" data-v-12b68786>}</span></span><span class="token punctuation" data-v-12b68786>)</span> <span class="token operator" data-v-12b68786>=&gt;</span> <span class="token punctuation" data-v-12b68786>{</span>
            <span class="token keyword" data-v-12b68786>const</span> columns <span class="token operator" data-v-12b68786>=</span> <span class="token punctuation" data-v-12b68786>[</span>
              <span class="token punctuation" data-v-12b68786>{</span>
                title<span class="token punctuation" data-v-12b68786>:</span> <span class="token string" data-v-12b68786>&quot;ID&quot;</span><span class="token punctuation" data-v-12b68786>,</span>
                dataIndex<span class="token punctuation" data-v-12b68786>:</span> <span class="token string" data-v-12b68786>&quot;id&quot;</span>
              <span class="token punctuation" data-v-12b68786>}</span><span class="token punctuation" data-v-12b68786>,</span>
              <span class="token punctuation" data-v-12b68786>{</span> title<span class="token punctuation" data-v-12b68786>:</span> <span class="token string" data-v-12b68786>&quot;Title&quot;</span><span class="token punctuation" data-v-12b68786>,</span> dataIndex<span class="token punctuation" data-v-12b68786>:</span> <span class="token string" data-v-12b68786>&quot;title&quot;</span> <span class="token punctuation" data-v-12b68786>}</span>
            <span class="token punctuation" data-v-12b68786>]</span><span class="token punctuation" data-v-12b68786>;</span>

            <span class="token keyword" data-v-12b68786>const</span> dataSource <span class="token operator" data-v-12b68786>=</span> data<span class="token punctuation" data-v-12b68786>.</span>posts <span class="token operator" data-v-12b68786>||</span> <span class="token punctuation" data-v-12b68786>[</span><span class="token punctuation" data-v-12b68786>]</span><span class="token punctuation" data-v-12b68786>;</span>
            <span class="token keyword" data-v-12b68786>return</span> <span class="token punctuation" data-v-12b68786>(</span>
              <span class="token operator" data-v-12b68786>&lt;</span>React<span class="token punctuation" data-v-12b68786>.</span>Fragment<span class="token operator" data-v-12b68786>&gt;</span>
                <span class="token operator" data-v-12b68786>&lt;</span>div style<span class="token operator" data-v-12b68786>=</span><span class="token punctuation" data-v-12b68786>{</span><span class="token punctuation" data-v-12b68786>{</span> marginBottom<span class="token punctuation" data-v-12b68786>:</span> <span class="token string" data-v-12b68786>&quot;12px&quot;</span> <span class="token punctuation" data-v-12b68786>}</span><span class="token punctuation" data-v-12b68786>}</span><span class="token operator" data-v-12b68786>&gt;</span>
                  <span class="token operator" data-v-12b68786>&lt;</span>Select
                    onChange<span class="token operator" data-v-12b68786>=</span><span class="token punctuation" data-v-12b68786>{</span><span class="token keyword" data-v-12b68786>this</span><span class="token punctuation" data-v-12b68786>.</span>onChangeLimit<span class="token punctuation" data-v-12b68786>}</span>
                    value<span class="token operator" data-v-12b68786>=</span><span class="token punctuation" data-v-12b68786>{</span><span class="token keyword" data-v-12b68786>this</span><span class="token punctuation" data-v-12b68786>.</span>state<span class="token punctuation" data-v-12b68786>.</span>limit<span class="token punctuation" data-v-12b68786>}</span>
                    style<span class="token operator" data-v-12b68786>=</span><span class="token punctuation" data-v-12b68786>{</span><span class="token punctuation" data-v-12b68786>{</span> width<span class="token punctuation" data-v-12b68786>:</span> <span class="token string" data-v-12b68786>&quot;100px&quot;</span> <span class="token punctuation" data-v-12b68786>}</span><span class="token punctuation" data-v-12b68786>}</span>
                  <span class="token operator" data-v-12b68786>&gt;</span>
                    <span class="token operator" data-v-12b68786>&lt;</span>Select<span class="token punctuation" data-v-12b68786>.</span>Option value<span class="token operator" data-v-12b68786>=</span><span class="token punctuation" data-v-12b68786>{</span><span class="token number" data-v-12b68786>5</span><span class="token punctuation" data-v-12b68786>}</span><span class="token operator" data-v-12b68786>&gt;</span><span class="token number" data-v-12b68786>5</span><span class="token operator" data-v-12b68786>&lt;</span><span class="token operator" data-v-12b68786>/</span>Select<span class="token punctuation" data-v-12b68786>.</span>Option<span class="token operator" data-v-12b68786>&gt;</span>
                    <span class="token operator" data-v-12b68786>&lt;</span>Select<span class="token punctuation" data-v-12b68786>.</span>Option value<span class="token operator" data-v-12b68786>=</span><span class="token punctuation" data-v-12b68786>{</span><span class="token number" data-v-12b68786>10</span><span class="token punctuation" data-v-12b68786>}</span><span class="token operator" data-v-12b68786>&gt;</span><span class="token number" data-v-12b68786>10</span><span class="token operator" data-v-12b68786>&lt;</span><span class="token operator" data-v-12b68786>/</span>Select<span class="token punctuation" data-v-12b68786>.</span>Option<span class="token operator" data-v-12b68786>&gt;</span>
                    <span class="token operator" data-v-12b68786>&lt;</span>Select<span class="token punctuation" data-v-12b68786>.</span>Option value<span class="token operator" data-v-12b68786>=</span><span class="token punctuation" data-v-12b68786>{</span><span class="token number" data-v-12b68786>15</span><span class="token punctuation" data-v-12b68786>}</span><span class="token operator" data-v-12b68786>&gt;</span><span class="token number" data-v-12b68786>15</span><span class="token operator" data-v-12b68786>&lt;</span><span class="token operator" data-v-12b68786>/</span>Select<span class="token punctuation" data-v-12b68786>.</span>Option<span class="token operator" data-v-12b68786>&gt;</span>
                  <span class="token operator" data-v-12b68786>&lt;</span><span class="token operator" data-v-12b68786>/</span>Select<span class="token operator" data-v-12b68786>&gt;</span>
                <span class="token operator" data-v-12b68786>&lt;</span><span class="token operator" data-v-12b68786>/</span>div<span class="token operator" data-v-12b68786>&gt;</span>
                <span class="token operator" data-v-12b68786>&lt;</span>Table
                  rowKey<span class="token operator" data-v-12b68786>=</span><span class="token punctuation" data-v-12b68786>{</span><span class="token parameter" data-v-12b68786>record</span> <span class="token operator" data-v-12b68786>=&gt;</span> record<span class="token punctuation" data-v-12b68786>.</span>id<span class="token punctuation" data-v-12b68786>}</span>
                  size<span class="token operator" data-v-12b68786>=</span><span class="token string" data-v-12b68786>&quot;small&quot;</span>
                  loading<span class="token operator" data-v-12b68786>=</span><span class="token punctuation" data-v-12b68786>{</span>loading<span class="token punctuation" data-v-12b68786>}</span>
                  dataSource<span class="token operator" data-v-12b68786>=</span><span class="token punctuation" data-v-12b68786>{</span>dataSource<span class="token punctuation" data-v-12b68786>}</span>
                  columns<span class="token operator" data-v-12b68786>=</span><span class="token punctuation" data-v-12b68786>{</span>columns<span class="token punctuation" data-v-12b68786>}</span>
                <span class="token operator" data-v-12b68786>/</span><span class="token operator" data-v-12b68786>&gt;</span>
              <span class="token operator" data-v-12b68786>&lt;</span><span class="token operator" data-v-12b68786>/</span>React<span class="token punctuation" data-v-12b68786>.</span>Fragment<span class="token operator" data-v-12b68786>&gt;</span>
            <span class="token punctuation" data-v-12b68786>)</span><span class="token punctuation" data-v-12b68786>;</span>
          <span class="token punctuation" data-v-12b68786>}</span><span class="token punctuation" data-v-12b68786>}</span>
        <span class="token operator" data-v-12b68786>&lt;</span><span class="token operator" data-v-12b68786>/</span>Query<span class="token operator" data-v-12b68786>&gt;</span>
      <span class="token operator" data-v-12b68786>&lt;</span><span class="token operator" data-v-12b68786>/</span>div<span class="token operator" data-v-12b68786>&gt;</span>
    <span class="token punctuation" data-v-12b68786>)</span><span class="token punctuation" data-v-12b68786>;</span>
  <span class="token punctuation" data-v-12b68786>}</span>
<span class="token punctuation" data-v-12b68786>}</span></code></pre></div><p data-v-12b68786><a rel="noopener noreferrer" target="_blank" href="https://codesandbox.io/s/pwmrnjz2km?initialpath=%2Ftable%2Flimit&amp;module=%2Fchapters%2FTable%2Flimit.tsx" data-v-12b68786><img src="https://codesandbox.io/static/img/play-codesandbox.svg#alt=Edit%20effective-apollo-antd" alt="" data-v-12b68786></a></p> <blockquote data-v-12b68786><p data-v-12b68786>在 <a rel="noopener noreferrer" target="_blank" href="https://graphql.org/learn/queries/#variables" data-v-12b68786>官方文档</a> 详细了解 GraphQL 查询变量定义</p></blockquote> <h3 id="操作数据-mutation" data-v-12b68786>操作数据 (Mutation)</h3> <p data-v-12b68786>接下来实现创建一篇 Post:</p> <p data-v-12b68786><img src="https://gbstatic.djyde.com/blog/68747470733a2f2f7773322e73696e61696d672e636e2f6c617267652f30303639525654646779316676356d3636757333676733306c7330636d3462302e676966.gif" alt="创建 Post 的表单" data-v-12b68786></p> <p data-v-12b68786>当我们需要操作数据的时候，就要用到 <code data-v-12b68786>Mutation</code>. 还用到一个特殊的数据类型 <a rel="noopener noreferrer" target="_blank" href="https://graphql.org/learn/schema/#input-types" data-v-12b68786>Input</a>. 通常用来在 <code data-v-12b68786>Mutation</code> 的参数里传一整个对象。</p> <div class="saber-highlight" data-lang="javascript" data-v-12b68786><pre class="saber-highlight-code language-javascript" data-v-12b68786><code class="language-javascript" data-v-12b68786><span class="token keyword" data-v-12b68786>const</span> typeDefs <span class="token operator" data-v-12b68786>=</span> gql<span class="token template-string" data-v-12b68786><span class="token template-punctuation string" data-v-12b68786>`</span><span class="token string" data-v-12b68786>
  input CreatePostInput {
    title: String!
    body: String!
  }

  Mutation {
    createPost(post: CreatePostInput!): Post!
  }
</span><span class="token template-punctuation string" data-v-12b68786>`</span></span></code></pre></div><p data-v-12b68786>然后在为 <code data-v-12b68786>createPost</code> 这个 <code data-v-12b68786>mutation</code> 创建一个 <code data-v-12b68786>resolver</code>:</p> <div class="saber-highlight" data-lang="javascript" data-v-12b68786><pre class="saber-highlight-code language-javascript" data-v-12b68786><code class="language-javascript" data-v-12b68786><span class="token keyword" data-v-12b68786>const</span> resolvers <span class="token operator" data-v-12b68786>=</span> <span class="token punctuation" data-v-12b68786>{</span>
  Mutation<span class="token punctuation" data-v-12b68786>:</span> <span class="token punctuation" data-v-12b68786>{</span>
    <span class="token keyword" data-v-12b68786>async</span> <span class="token function" data-v-12b68786>createPost</span><span class="token punctuation" data-v-12b68786>(</span><span class="token parameter" data-v-12b68786>root<span class="token punctuation" data-v-12b68786>,</span> args</span><span class="token punctuation" data-v-12b68786>)</span> <span class="token punctuation" data-v-12b68786>{</span>
      <span class="token keyword" data-v-12b68786>const</span> <span class="token punctuation" data-v-12b68786>{</span>
        post
      <span class="token punctuation" data-v-12b68786>}</span> <span class="token operator" data-v-12b68786>=</span> args

      <span class="token keyword" data-v-12b68786>const</span> res <span class="token operator" data-v-12b68786>=</span> <span class="token keyword" data-v-12b68786>await</span> http<span class="token punctuation" data-v-12b68786>.</span><span class="token function" data-v-12b68786>post</span><span class="token punctuation" data-v-12b68786>(</span><span class="token string" data-v-12b68786>'/posts'</span><span class="token punctuation" data-v-12b68786>,</span> <span class="token punctuation" data-v-12b68786>{</span>
        data<span class="token punctuation" data-v-12b68786>:</span> post
      <span class="token punctuation" data-v-12b68786>}</span><span class="token punctuation" data-v-12b68786>)</span>

      <span class="token keyword" data-v-12b68786>const</span> now <span class="token operator" data-v-12b68786>=</span> Date<span class="token punctuation" data-v-12b68786>.</span><span class="token function" data-v-12b68786>now</span><span class="token punctuation" data-v-12b68786>(</span><span class="token punctuation" data-v-12b68786>)</span>
      <span class="token keyword" data-v-12b68786>const</span> id <span class="token operator" data-v-12b68786>=</span> <span class="token function" data-v-12b68786>Number</span><span class="token punctuation" data-v-12b68786>(</span>now<span class="token punctuation" data-v-12b68786>.</span><span class="token function" data-v-12b68786>toString</span><span class="token punctuation" data-v-12b68786>(</span><span class="token punctuation" data-v-12b68786>)</span><span class="token punctuation" data-v-12b68786>.</span><span class="token function" data-v-12b68786>slice</span><span class="token punctuation" data-v-12b68786>(</span><span class="token number" data-v-12b68786>8</span><span class="token punctuation" data-v-12b68786>,</span> <span class="token number" data-v-12b68786>13</span><span class="token punctuation" data-v-12b68786>)</span><span class="token punctuation" data-v-12b68786>)</span>

      <span class="token keyword" data-v-12b68786>return</span> <span class="token punctuation" data-v-12b68786>{</span>
        <span class="token operator" data-v-12b68786>...</span>res<span class="token punctuation" data-v-12b68786>.</span>data<span class="token punctuation" data-v-12b68786>.</span>data<span class="token punctuation" data-v-12b68786>,</span>
        id<span class="token punctuation" data-v-12b68786>,</span>
        userId<span class="token punctuation" data-v-12b68786>:</span> <span class="token number" data-v-12b68786>12</span>
      <span class="token punctuation" data-v-12b68786>}</span>
    <span class="token punctuation" data-v-12b68786>}</span>
  <span class="token punctuation" data-v-12b68786>}</span>
<span class="token punctuation" data-v-12b68786>}</span></code></pre></div><p data-v-12b68786>前端结合 Ant.Design 的 <code data-v-12b68786>&lt;Modal /&gt;</code>, <code data-v-12b68786>&lt;Form /&gt;</code> 组件和 <code data-v-12b68786>react-apollo</code> 提供的 <code data-v-12b68786>&lt;Mutation /&gt;</code> 组件，就可以完成整个「新建 Post」动作：</p> <div class="saber-highlight" data-lang="javascript" data-v-12b68786><pre class="saber-highlight-code language-javascript" data-v-12b68786><code class="language-javascript" data-v-12b68786><span class="token keyword" data-v-12b68786>const</span> <span class="token constant" data-v-12b68786>GET_POSTS</span> <span class="token operator" data-v-12b68786>=</span> gql<span class="token template-string" data-v-12b68786><span class="token template-punctuation string" data-v-12b68786>`</span><span class="token string" data-v-12b68786>
  query GetPost($limit: Int) {
    posts(limit: $limit) {
      id, title
    }
  }
</span><span class="token template-punctuation string" data-v-12b68786>`</span></span><span class="token punctuation" data-v-12b68786>;</span>

<span class="token comment" data-v-12b68786>// 「新建 Post」 的 Muation</span>
<span class="token keyword" data-v-12b68786>const</span> <span class="token constant" data-v-12b68786>CREATE_POST</span> <span class="token operator" data-v-12b68786>=</span> gql<span class="token template-string" data-v-12b68786><span class="token template-punctuation string" data-v-12b68786>`</span><span class="token string" data-v-12b68786>
  mutation CreatePost($post: CreatePostInput!) {
    createPost(post: $post) {
      id, title
    }
  }
</span><span class="token template-punctuation string" data-v-12b68786>`</span></span>

<span class="token keyword" data-v-12b68786>class</span> <span class="token class-name" data-v-12b68786>CreatePost</span> <span class="token keyword" data-v-12b68786>extends</span> <span class="token class-name" data-v-12b68786>React<span class="token punctuation" data-v-12b68786>.</span>Component</span> <span class="token punctuation" data-v-12b68786>{</span>
  state <span class="token operator" data-v-12b68786>=</span> <span class="token punctuation" data-v-12b68786>{</span>
    modalVisible<span class="token punctuation" data-v-12b68786>:</span> <span class="token boolean" data-v-12b68786>false</span>
  <span class="token punctuation" data-v-12b68786>}</span><span class="token punctuation" data-v-12b68786>;</span>

  <span class="token function-variable function" data-v-12b68786>showModal</span> <span class="token operator" data-v-12b68786>=</span> <span class="token punctuation" data-v-12b68786>(</span><span class="token punctuation" data-v-12b68786>)</span> <span class="token operator" data-v-12b68786>=&gt;</span> <span class="token punctuation" data-v-12b68786>{</span>
    <span class="token keyword" data-v-12b68786>this</span><span class="token punctuation" data-v-12b68786>.</span><span class="token function" data-v-12b68786>setState</span><span class="token punctuation" data-v-12b68786>(</span><span class="token punctuation" data-v-12b68786>{</span> modalVisible<span class="token punctuation" data-v-12b68786>:</span> <span class="token boolean" data-v-12b68786>true</span> <span class="token punctuation" data-v-12b68786>}</span><span class="token punctuation" data-v-12b68786>)</span><span class="token punctuation" data-v-12b68786>;</span>
  <span class="token punctuation" data-v-12b68786>}</span><span class="token punctuation" data-v-12b68786>;</span>

  <span class="token function-variable function" data-v-12b68786>closeModal</span> <span class="token operator" data-v-12b68786>=</span> <span class="token punctuation" data-v-12b68786>(</span><span class="token punctuation" data-v-12b68786>)</span> <span class="token operator" data-v-12b68786>=&gt;</span> <span class="token punctuation" data-v-12b68786>{</span>
    <span class="token keyword" data-v-12b68786>this</span><span class="token punctuation" data-v-12b68786>.</span><span class="token function" data-v-12b68786>setState</span><span class="token punctuation" data-v-12b68786>(</span><span class="token punctuation" data-v-12b68786>{</span> modalVisible<span class="token punctuation" data-v-12b68786>:</span> <span class="token boolean" data-v-12b68786>false</span> <span class="token punctuation" data-v-12b68786>}</span><span class="token punctuation" data-v-12b68786>)</span><span class="token punctuation" data-v-12b68786>;</span>
  <span class="token punctuation" data-v-12b68786>}</span><span class="token punctuation" data-v-12b68786>;</span>

  <span class="token comment" data-v-12b68786>// Modal 的 onOk 事件</span>
  <span class="token function-variable function" data-v-12b68786>onCreatePost</span> <span class="token operator" data-v-12b68786>=</span> <span class="token parameter" data-v-12b68786>createPost</span> <span class="token operator" data-v-12b68786>=&gt;</span> <span class="token punctuation" data-v-12b68786>{</span>
    <span class="token keyword" data-v-12b68786>const</span> <span class="token punctuation" data-v-12b68786>{</span> form <span class="token punctuation" data-v-12b68786>}</span> <span class="token operator" data-v-12b68786>=</span> <span class="token keyword" data-v-12b68786>this</span><span class="token punctuation" data-v-12b68786>.</span>props<span class="token punctuation" data-v-12b68786>;</span>
    form<span class="token punctuation" data-v-12b68786>.</span><span class="token function" data-v-12b68786>validateFields</span><span class="token punctuation" data-v-12b68786>(</span><span class="token keyword" data-v-12b68786>async</span> <span class="token punctuation" data-v-12b68786>(</span><span class="token parameter" data-v-12b68786>err<span class="token punctuation" data-v-12b68786>,</span> values</span><span class="token punctuation" data-v-12b68786>)</span> <span class="token operator" data-v-12b68786>=&gt;</span> <span class="token punctuation" data-v-12b68786>{</span>
      <span class="token keyword" data-v-12b68786>if</span> <span class="token punctuation" data-v-12b68786>(</span><span class="token operator" data-v-12b68786>!</span>err<span class="token punctuation" data-v-12b68786>)</span> <span class="token punctuation" data-v-12b68786>{</span>
        <span class="token comment" data-v-12b68786>// `createPost` 是 `&lt;Mutation /&gt;` 组件传给 children 的 mutation 方法</span>
        <span class="token keyword" data-v-12b68786>await</span> <span class="token function" data-v-12b68786>createPost</span><span class="token punctuation" data-v-12b68786>(</span><span class="token punctuation" data-v-12b68786>{</span> variables<span class="token punctuation" data-v-12b68786>:</span> <span class="token punctuation" data-v-12b68786>{</span> post<span class="token punctuation" data-v-12b68786>:</span> values <span class="token punctuation" data-v-12b68786>}</span> <span class="token punctuation" data-v-12b68786>}</span><span class="token punctuation" data-v-12b68786>)</span><span class="token punctuation" data-v-12b68786>;</span>
        <span class="token keyword" data-v-12b68786>this</span><span class="token punctuation" data-v-12b68786>.</span><span class="token function" data-v-12b68786>closeModal</span><span class="token punctuation" data-v-12b68786>(</span><span class="token punctuation" data-v-12b68786>)</span><span class="token punctuation" data-v-12b68786>;</span>
        form<span class="token punctuation" data-v-12b68786>.</span><span class="token function" data-v-12b68786>resetFields</span><span class="token punctuation" data-v-12b68786>(</span><span class="token punctuation" data-v-12b68786>)</span><span class="token punctuation" data-v-12b68786>;</span>
      <span class="token punctuation" data-v-12b68786>}</span>
    <span class="token punctuation" data-v-12b68786>}</span><span class="token punctuation" data-v-12b68786>)</span><span class="token punctuation" data-v-12b68786>;</span>
  <span class="token punctuation" data-v-12b68786>}</span><span class="token punctuation" data-v-12b68786>;</span>

  <span class="token function" data-v-12b68786>render</span><span class="token punctuation" data-v-12b68786>(</span><span class="token punctuation" data-v-12b68786>)</span> <span class="token punctuation" data-v-12b68786>{</span>
    <span class="token keyword" data-v-12b68786>const</span> <span class="token punctuation" data-v-12b68786>{</span> form <span class="token punctuation" data-v-12b68786>}</span> <span class="token operator" data-v-12b68786>=</span> <span class="token keyword" data-v-12b68786>this</span><span class="token punctuation" data-v-12b68786>.</span>props<span class="token punctuation" data-v-12b68786>;</span>

    <span class="token keyword" data-v-12b68786>return</span> <span class="token punctuation" data-v-12b68786>(</span>
      <span class="token operator" data-v-12b68786>&lt;</span>div style<span class="token operator" data-v-12b68786>=</span><span class="token punctuation" data-v-12b68786>{</span><span class="token punctuation" data-v-12b68786>{</span> padding<span class="token punctuation" data-v-12b68786>:</span> <span class="token string" data-v-12b68786>&quot;2rem&quot;</span> <span class="token punctuation" data-v-12b68786>}</span><span class="token punctuation" data-v-12b68786>}</span><span class="token operator" data-v-12b68786>&gt;</span>
        <span class="token operator" data-v-12b68786>&lt;</span>Query query<span class="token operator" data-v-12b68786>=</span><span class="token punctuation" data-v-12b68786>{</span><span class="token constant" data-v-12b68786>GET_POSTS</span><span class="token punctuation" data-v-12b68786>}</span> variables<span class="token operator" data-v-12b68786>=</span><span class="token punctuation" data-v-12b68786>{</span><span class="token punctuation" data-v-12b68786>{</span> limit<span class="token punctuation" data-v-12b68786>:</span> <span class="token number" data-v-12b68786>5</span> <span class="token punctuation" data-v-12b68786>}</span><span class="token punctuation" data-v-12b68786>}</span><span class="token operator" data-v-12b68786>&gt;</span>
          <span class="token punctuation" data-v-12b68786>{</span><span class="token punctuation" data-v-12b68786>(</span><span class="token parameter" data-v-12b68786><span class="token punctuation" data-v-12b68786>{</span> loading<span class="token punctuation" data-v-12b68786>,</span> data <span class="token punctuation" data-v-12b68786>}</span></span><span class="token punctuation" data-v-12b68786>)</span> <span class="token operator" data-v-12b68786>=&gt;</span> <span class="token punctuation" data-v-12b68786>{</span>
            <span class="token keyword" data-v-12b68786>const</span> columns <span class="token operator" data-v-12b68786>=</span> <span class="token punctuation" data-v-12b68786>[</span>
              <span class="token punctuation" data-v-12b68786>{</span>
                title<span class="token punctuation" data-v-12b68786>:</span> <span class="token string" data-v-12b68786>&quot;ID&quot;</span><span class="token punctuation" data-v-12b68786>,</span>
                dataIndex<span class="token punctuation" data-v-12b68786>:</span> <span class="token string" data-v-12b68786>&quot;id&quot;</span>
              <span class="token punctuation" data-v-12b68786>}</span><span class="token punctuation" data-v-12b68786>,</span>
              <span class="token punctuation" data-v-12b68786>{</span> title<span class="token punctuation" data-v-12b68786>:</span> <span class="token string" data-v-12b68786>&quot;Title&quot;</span><span class="token punctuation" data-v-12b68786>,</span> dataIndex<span class="token punctuation" data-v-12b68786>:</span> <span class="token string" data-v-12b68786>&quot;title&quot;</span> <span class="token punctuation" data-v-12b68786>}</span>
            <span class="token punctuation" data-v-12b68786>]</span><span class="token punctuation" data-v-12b68786>;</span>

            <span class="token keyword" data-v-12b68786>const</span> dataSource <span class="token operator" data-v-12b68786>=</span> data<span class="token punctuation" data-v-12b68786>.</span>posts <span class="token operator" data-v-12b68786>||</span> <span class="token punctuation" data-v-12b68786>[</span><span class="token punctuation" data-v-12b68786>]</span><span class="token punctuation" data-v-12b68786>;</span>
            <span class="token keyword" data-v-12b68786>return</span> <span class="token punctuation" data-v-12b68786>(</span>
              <span class="token operator" data-v-12b68786>&lt;</span>React<span class="token punctuation" data-v-12b68786>.</span>Fragment<span class="token operator" data-v-12b68786>&gt;</span>
                <span class="token operator" data-v-12b68786>&lt;</span>Mutation mutation<span class="token operator" data-v-12b68786>=</span><span class="token punctuation" data-v-12b68786>{</span><span class="token constant" data-v-12b68786>CREATE_POST</span><span class="token punctuation" data-v-12b68786>}</span><span class="token operator" data-v-12b68786>&gt;</span>
                  <span class="token punctuation" data-v-12b68786>{</span><span class="token punctuation" data-v-12b68786>(</span><span class="token parameter" data-v-12b68786>createPost<span class="token punctuation" data-v-12b68786>,</span> <span class="token punctuation" data-v-12b68786>{</span> loading<span class="token punctuation" data-v-12b68786>,</span> data <span class="token punctuation" data-v-12b68786>}</span></span><span class="token punctuation" data-v-12b68786>)</span> <span class="token operator" data-v-12b68786>=&gt;</span> <span class="token punctuation" data-v-12b68786>{</span>
                    <span class="token keyword" data-v-12b68786>return</span> <span class="token punctuation" data-v-12b68786>(</span>
                      <span class="token operator" data-v-12b68786>&lt;</span>Modal
                        onOk<span class="token operator" data-v-12b68786>=</span><span class="token punctuation" data-v-12b68786>{</span><span class="token parameter" data-v-12b68786>e</span> <span class="token operator" data-v-12b68786>=&gt;</span> <span class="token keyword" data-v-12b68786>this</span><span class="token punctuation" data-v-12b68786>.</span><span class="token function" data-v-12b68786>onCreatePost</span><span class="token punctuation" data-v-12b68786>(</span>createPost<span class="token punctuation" data-v-12b68786>)</span><span class="token punctuation" data-v-12b68786>}</span>
                        onCancel<span class="token operator" data-v-12b68786>=</span><span class="token punctuation" data-v-12b68786>{</span><span class="token keyword" data-v-12b68786>this</span><span class="token punctuation" data-v-12b68786>.</span>closeModal<span class="token punctuation" data-v-12b68786>}</span>
                        title<span class="token operator" data-v-12b68786>=</span><span class="token string" data-v-12b68786>&quot;Create Post&quot;</span>
                        confirmLoading<span class="token operator" data-v-12b68786>=</span><span class="token punctuation" data-v-12b68786>{</span>loading<span class="token punctuation" data-v-12b68786>}</span>
                        visible<span class="token operator" data-v-12b68786>=</span><span class="token punctuation" data-v-12b68786>{</span><span class="token keyword" data-v-12b68786>this</span><span class="token punctuation" data-v-12b68786>.</span>state<span class="token punctuation" data-v-12b68786>.</span>modalVisible<span class="token punctuation" data-v-12b68786>}</span>
                      <span class="token operator" data-v-12b68786>&gt;</span>
                        <span class="token operator" data-v-12b68786>&lt;</span>Form<span class="token operator" data-v-12b68786>&gt;</span>
                          <span class="token operator" data-v-12b68786>&lt;</span>Form<span class="token punctuation" data-v-12b68786>.</span>Item label<span class="token operator" data-v-12b68786>=</span><span class="token string" data-v-12b68786>&quot;Title&quot;</span><span class="token operator" data-v-12b68786>&gt;</span>
                            <span class="token punctuation" data-v-12b68786>{</span>form<span class="token punctuation" data-v-12b68786>.</span><span class="token function" data-v-12b68786>getFieldDecorator</span><span class="token punctuation" data-v-12b68786>(</span><span class="token string" data-v-12b68786>&quot;title&quot;</span><span class="token punctuation" data-v-12b68786>,</span> <span class="token punctuation" data-v-12b68786>{</span>
                              rules<span class="token punctuation" data-v-12b68786>:</span> <span class="token punctuation" data-v-12b68786>[</span><span class="token punctuation" data-v-12b68786>{</span> required<span class="token punctuation" data-v-12b68786>:</span> <span class="token boolean" data-v-12b68786>true</span> <span class="token punctuation" data-v-12b68786>}</span><span class="token punctuation" data-v-12b68786>]</span>
                            <span class="token punctuation" data-v-12b68786>}</span><span class="token punctuation" data-v-12b68786>)</span><span class="token punctuation" data-v-12b68786>(</span><span class="token operator" data-v-12b68786>&lt;</span>Input <span class="token operator" data-v-12b68786>/</span><span class="token operator" data-v-12b68786>&gt;</span><span class="token punctuation" data-v-12b68786>)</span><span class="token punctuation" data-v-12b68786>}</span>
                          <span class="token operator" data-v-12b68786>&lt;</span><span class="token operator" data-v-12b68786>/</span>Form<span class="token punctuation" data-v-12b68786>.</span>Item<span class="token operator" data-v-12b68786>&gt;</span>
                          <span class="token operator" data-v-12b68786>&lt;</span>Form<span class="token punctuation" data-v-12b68786>.</span>Item label<span class="token operator" data-v-12b68786>=</span><span class="token string" data-v-12b68786>&quot;Body&quot;</span><span class="token operator" data-v-12b68786>&gt;</span>
                            <span class="token punctuation" data-v-12b68786>{</span>form<span class="token punctuation" data-v-12b68786>.</span><span class="token function" data-v-12b68786>getFieldDecorator</span><span class="token punctuation" data-v-12b68786>(</span><span class="token string" data-v-12b68786>&quot;body&quot;</span><span class="token punctuation" data-v-12b68786>,</span> <span class="token punctuation" data-v-12b68786>{</span>
                              rules<span class="token punctuation" data-v-12b68786>:</span> <span class="token punctuation" data-v-12b68786>[</span><span class="token punctuation" data-v-12b68786>{</span> required<span class="token punctuation" data-v-12b68786>:</span> <span class="token boolean" data-v-12b68786>true</span> <span class="token punctuation" data-v-12b68786>}</span><span class="token punctuation" data-v-12b68786>]</span>
                            <span class="token punctuation" data-v-12b68786>}</span><span class="token punctuation" data-v-12b68786>)</span><span class="token punctuation" data-v-12b68786>(</span><span class="token operator" data-v-12b68786>&lt;</span>Input<span class="token punctuation" data-v-12b68786>.</span>TextArea <span class="token operator" data-v-12b68786>/</span><span class="token operator" data-v-12b68786>&gt;</span><span class="token punctuation" data-v-12b68786>)</span><span class="token punctuation" data-v-12b68786>}</span>
                          <span class="token operator" data-v-12b68786>&lt;</span><span class="token operator" data-v-12b68786>/</span>Form<span class="token punctuation" data-v-12b68786>.</span>Item<span class="token operator" data-v-12b68786>&gt;</span>
                        <span class="token operator" data-v-12b68786>&lt;</span><span class="token operator" data-v-12b68786>/</span>Form<span class="token operator" data-v-12b68786>&gt;</span>
                      <span class="token operator" data-v-12b68786>&lt;</span><span class="token operator" data-v-12b68786>/</span>Modal<span class="token operator" data-v-12b68786>&gt;</span>
                    <span class="token punctuation" data-v-12b68786>)</span><span class="token punctuation" data-v-12b68786>;</span>
                  <span class="token punctuation" data-v-12b68786>}</span><span class="token punctuation" data-v-12b68786>}</span>
                <span class="token operator" data-v-12b68786>&lt;</span><span class="token operator" data-v-12b68786>/</span>Mutation<span class="token operator" data-v-12b68786>&gt;</span>
                <span class="token operator" data-v-12b68786>&lt;</span>div style<span class="token operator" data-v-12b68786>=</span><span class="token punctuation" data-v-12b68786>{</span><span class="token punctuation" data-v-12b68786>{</span> marginBottom<span class="token punctuation" data-v-12b68786>:</span> <span class="token string" data-v-12b68786>&quot;12px&quot;</span> <span class="token punctuation" data-v-12b68786>}</span><span class="token punctuation" data-v-12b68786>}</span><span class="token operator" data-v-12b68786>&gt;</span>
                  <span class="token operator" data-v-12b68786>&lt;</span>Button onClick<span class="token operator" data-v-12b68786>=</span><span class="token punctuation" data-v-12b68786>{</span><span class="token keyword" data-v-12b68786>this</span><span class="token punctuation" data-v-12b68786>.</span>showModal<span class="token punctuation" data-v-12b68786>}</span> type<span class="token operator" data-v-12b68786>=</span><span class="token string" data-v-12b68786>&quot;primary&quot;</span><span class="token operator" data-v-12b68786>&gt;</span>
                    New Post
                  <span class="token operator" data-v-12b68786>&lt;</span><span class="token operator" data-v-12b68786>/</span>Button<span class="token operator" data-v-12b68786>&gt;</span>
                <span class="token operator" data-v-12b68786>&lt;</span><span class="token operator" data-v-12b68786>/</span>div<span class="token operator" data-v-12b68786>&gt;</span>
                <span class="token operator" data-v-12b68786>&lt;</span>Table
                  rowKey<span class="token operator" data-v-12b68786>=</span><span class="token punctuation" data-v-12b68786>{</span><span class="token parameter" data-v-12b68786>record</span> <span class="token operator" data-v-12b68786>=&gt;</span> record<span class="token punctuation" data-v-12b68786>.</span>id<span class="token punctuation" data-v-12b68786>}</span>
                  size<span class="token operator" data-v-12b68786>=</span><span class="token string" data-v-12b68786>&quot;small&quot;</span>
                  loading<span class="token operator" data-v-12b68786>=</span><span class="token punctuation" data-v-12b68786>{</span>loading<span class="token punctuation" data-v-12b68786>}</span>
                  dataSource<span class="token operator" data-v-12b68786>=</span><span class="token punctuation" data-v-12b68786>{</span>dataSource<span class="token punctuation" data-v-12b68786>}</span>
                  columns<span class="token operator" data-v-12b68786>=</span><span class="token punctuation" data-v-12b68786>{</span>columns<span class="token punctuation" data-v-12b68786>}</span>
                <span class="token operator" data-v-12b68786>/</span><span class="token operator" data-v-12b68786>&gt;</span>
              <span class="token operator" data-v-12b68786>&lt;</span><span class="token operator" data-v-12b68786>/</span>React<span class="token punctuation" data-v-12b68786>.</span>Fragment<span class="token operator" data-v-12b68786>&gt;</span>
            <span class="token punctuation" data-v-12b68786>)</span><span class="token punctuation" data-v-12b68786>;</span>
          <span class="token punctuation" data-v-12b68786>}</span><span class="token punctuation" data-v-12b68786>}</span>
        <span class="token operator" data-v-12b68786>&lt;</span><span class="token operator" data-v-12b68786>/</span>Query<span class="token operator" data-v-12b68786>&gt;</span>
      <span class="token operator" data-v-12b68786>&lt;</span><span class="token operator" data-v-12b68786>/</span>div<span class="token operator" data-v-12b68786>&gt;</span>
    <span class="token punctuation" data-v-12b68786>)</span><span class="token punctuation" data-v-12b68786>;</span>
  <span class="token punctuation" data-v-12b68786>}</span>
<span class="token punctuation" data-v-12b68786>}</span>

<span class="token keyword" data-v-12b68786>export</span> <span class="token keyword" data-v-12b68786>default</span> Form<span class="token punctuation" data-v-12b68786>.</span><span class="token function" data-v-12b68786>create</span><span class="token punctuation" data-v-12b68786>(</span><span class="token punctuation" data-v-12b68786>)</span><span class="token punctuation" data-v-12b68786>(</span>CreatePost<span class="token punctuation" data-v-12b68786>)</span><span class="token punctuation" data-v-12b68786>;</span></code></pre></div><p data-v-12b68786><a rel="noopener noreferrer" target="_blank" href="https://codesandbox.io/s/pwmrnjz2km?initialpath=%2Ftable%2Fcreate&amp;module=%2Fchapters%2FTable%2Fcreate.tsx" data-v-12b68786><img src="https://codesandbox.io/static/img/play-codesandbox.svg#alt=Edit%20effective-apollo-antd" alt="" data-v-12b68786></a></p> <p data-v-12b68786>和 <code data-v-12b68786>&lt;Query /&gt;</code> 一样，<code data-v-12b68786>&lt;Mutation /&gt;</code> 把请求状态都传递给了 children.</p> <blockquote data-v-12b68786><p data-v-12b68786>在 <a rel="noopener noreferrer" target="_blank" href="https://www.apollographql.com/docs/react/essentials/mutations.html" data-v-12b68786>官方文档</a> 详细了解 <code data-v-12b68786>&lt;Mutation /&gt;</code> 的用法</p></blockquote> <h3 id="操作成功后更新列表数据" data-v-12b68786>操作成功后更新列表数据</h3> <p data-v-12b68786>成功「新建 Post」以后，通常我们会更新数据列表。<code data-v-12b68786>react-apollo</code> 有两种方法实现。</p> <h4 id="更新查询的-cache" data-v-12b68786>更新查询的 Cache</h4> <p data-v-12b68786><code data-v-12b68786>&lt;Mutation /&gt;</code> 有 <code data-v-12b68786>update</code> 这个 props. 在 <code data-v-12b68786>mutation</code> 执行成功后回调，并且带有 <code data-v-12b68786>cache</code> 和 <code data-v-12b68786>mutation</code> 的响应数据。我们可以通过更新 <code data-v-12b68786>cache</code> 来实现更新数据列表。</p> <p data-v-12b68786>例如，在获取数据列表的 <code data-v-12b68786>&lt;Query /&gt;</code> 中，是通过 <code data-v-12b68786>GET_POSTS</code> 来查询的：</p> <div class="saber-highlight" data-lang="javascript" data-v-12b68786><pre class="saber-highlight-code language-javascript" data-v-12b68786><code class="language-javascript" data-v-12b68786>query<span class="token operator" data-v-12b68786>=</span><span class="token punctuation" data-v-12b68786>{</span><span class="token constant" data-v-12b68786>GET_POSTS</span><span class="token punctuation" data-v-12b68786>}</span> variables<span class="token operator" data-v-12b68786>=</span><span class="token punctuation" data-v-12b68786>{</span><span class="token punctuation" data-v-12b68786>{</span> limit<span class="token punctuation" data-v-12b68786>:</span> <span class="token number" data-v-12b68786>5</span> <span class="token punctuation" data-v-12b68786>}</span><span class="token punctuation" data-v-12b68786>}</span></code></pre></div><p data-v-12b68786>那么，在 <code data-v-12b68786>update</code> 回调里，我们可以得到 <code data-v-12b68786>GET_POSTS</code> 对应的 cache, 然后更新这个 cache. 更新 cache 后，通过 <code data-v-12b68786>GET_POSTS</code> (以及相同的 <code data-v-12b68786>variables</code>) 查询的组件，会自动 rerender:</p> <div class="saber-highlight" data-lang="typescript" data-v-12b68786><pre class="saber-highlight-code language-typescript" data-v-12b68786><code class="language-typescript" data-v-12b68786><span class="token keyword" data-v-12b68786>const</span> <span class="token function-variable function" data-v-12b68786>update</span> <span class="token operator" data-v-12b68786>=</span> <span class="token punctuation" data-v-12b68786>(</span><span class="token parameter" data-v-12b68786>cache<span class="token punctuation" data-v-12b68786>,</span> <span class="token punctuation" data-v-12b68786>{</span> data<span class="token punctuation" data-v-12b68786>:</span> <span class="token punctuation" data-v-12b68786>{</span> createPost <span class="token punctuation" data-v-12b68786>}</span> <span class="token punctuation" data-v-12b68786>}</span></span><span class="token punctuation" data-v-12b68786>)</span> <span class="token operator" data-v-12b68786>=&gt;</span> <span class="token punctuation" data-v-12b68786>{</span>
  <span class="token comment" data-v-12b68786>// 取得 `GET_POSTS` 对应的 cache</span>
  <span class="token comment" data-v-12b68786>// 注意要和你要更新的组件的 query 和 variables 都要一致</span>
  <span class="token keyword" data-v-12b68786>const</span> <span class="token punctuation" data-v-12b68786>{</span> posts <span class="token punctuation" data-v-12b68786>}</span> <span class="token operator" data-v-12b68786>=</span> cache<span class="token punctuation" data-v-12b68786>.</span><span class="token function" data-v-12b68786>readQuery</span><span class="token punctuation" data-v-12b68786>(</span><span class="token punctuation" data-v-12b68786>{</span> query<span class="token punctuation" data-v-12b68786>:</span> <span class="token constant" data-v-12b68786>GET_POSTS</span><span class="token punctuation" data-v-12b68786>,</span> variables<span class="token punctuation" data-v-12b68786>:</span> <span class="token punctuation" data-v-12b68786>{</span> limit<span class="token punctuation" data-v-12b68786>:</span> <span class="token number" data-v-12b68786>5</span> <span class="token punctuation" data-v-12b68786>}</span> <span class="token punctuation" data-v-12b68786>}</span><span class="token punctuation" data-v-12b68786>)</span>
  <span class="token comment" data-v-12b68786>// 用 mutation 的响应数据更新 cache</span>
  <span class="token comment" data-v-12b68786>// 同样，query 和 variables 都要一致</span>
  cache<span class="token punctuation" data-v-12b68786>.</span><span class="token function" data-v-12b68786>writeQuery</span><span class="token punctuation" data-v-12b68786>(</span><span class="token punctuation" data-v-12b68786>{</span>
    query<span class="token punctuation" data-v-12b68786>,</span> <span class="token constant" data-v-12b68786>GET_POSTS</span><span class="token punctuation" data-v-12b68786>,</span>
    variables<span class="token punctuation" data-v-12b68786>:</span> <span class="token punctuation" data-v-12b68786>{</span> limit<span class="token punctuation" data-v-12b68786>:</span> <span class="token number" data-v-12b68786>5</span> <span class="token punctuation" data-v-12b68786>}</span><span class="token punctuation" data-v-12b68786>,</span>
    data<span class="token punctuation" data-v-12b68786>:</span> <span class="token punctuation" data-v-12b68786>{</span> posts<span class="token punctuation" data-v-12b68786>:</span> <span class="token punctuation" data-v-12b68786>[</span>createPost<span class="token punctuation" data-v-12b68786>]</span><span class="token punctuation" data-v-12b68786>.</span><span class="token function" data-v-12b68786>concat</span><span class="token punctuation" data-v-12b68786>(</span>posts<span class="token punctuation" data-v-12b68786>)</span> <span class="token punctuation" data-v-12b68786>}</span>
  <span class="token punctuation" data-v-12b68786>}</span><span class="token punctuation" data-v-12b68786>)</span>
<span class="token punctuation" data-v-12b68786>}</span></code></pre></div><h4 id="重新执行查询" data-v-12b68786>重新执行查询</h4> <p data-v-12b68786>有时我们想要直接重新请求数据列表而不是手动更新 cache. 我们可以使用 <code data-v-12b68786>refetchQueries</code> 返回一个你要重新查询的查询数组：</p> <div class="saber-highlight" data-lang="javascript" data-v-12b68786><pre class="saber-highlight-code language-javascript" data-v-12b68786><code class="language-javascript" data-v-12b68786><span class="token keyword" data-v-12b68786>const</span> <span class="token function-variable function" data-v-12b68786>refetch</span> <span class="token operator" data-v-12b68786>=</span> <span class="token punctuation" data-v-12b68786>(</span><span class="token punctuation" data-v-12b68786>)</span> <span class="token operator" data-v-12b68786>=&gt;</span> <span class="token punctuation" data-v-12b68786>{</span>
  <span class="token keyword" data-v-12b68786>return</span> <span class="token punctuation" data-v-12b68786>[</span>
    <span class="token punctuation" data-v-12b68786>{</span> query<span class="token punctuation" data-v-12b68786>:</span> <span class="token constant" data-v-12b68786>GET_POSTS</span> <span class="token punctuation" data-v-12b68786>}</span>
  <span class="token punctuation" data-v-12b68786>]</span>
<span class="token punctuation" data-v-12b68786>}</span></code></pre></div><p data-v-12b68786>这样，所有 query 是 <code data-v-12b68786>GET_POSTS</code> 的组件都会重新执行查询并 rerender.</p> <h3 id="分页异步加载" data-v-12b68786>分页异步加载</h3> <p data-v-12b68786>Ant.Design 的 <code data-v-12b68786>Table</code> 组件可以通过 <code data-v-12b68786>Pagination</code> 很容易地实现<a rel="noopener noreferrer" target="_blank" href="https://ant.design/components/table-cn/#components-table-demo-ajax" data-v-12b68786>分页异步加载</a>.</p> <p data-v-12b68786><img src="https://gbstatic.djyde.com/blog/68747470733a2f2f7773342e73696e61696d672e636e2f6c617267652f30303639525654646779316676356d3434306467356733306c693065366b6a6c2e676966.gif" alt="分页加载表格数据" data-v-12b68786></p> <p data-v-12b68786>首先先让 GraphQL 接口支持分页：</p> <div class="saber-highlight" data-lang="diff" data-v-12b68786><pre class="saber-highlight-code language-diff" data-v-12b68786><code class="language-diff" data-v-12b68786>const typeDefs = gql`
<span class="token unchanged" data-v-12b68786> type Post {
    userId: Int!
    id: Int!
    title: String!
    body: String!
  }
</span>
<span class="token inserted-sign inserted" data-v-12b68786>+ type Meta {
+   total: Int!
+ }
</span>
<span class="token inserted-sign inserted" data-v-12b68786>+ type PostResultWithMeta {
+   metadata: Meta!
+   data: [Post]!
+ }
</span>
<span class="token unchanged" data-v-12b68786>  type Query {
    posts(page: Int, limit: Int): [Post]
</span><span class="token inserted-sign inserted" data-v-12b68786>+   postsWithMeta(page: Int, limit: Int!): PostResultWithMeta!
</span><span class="token unchanged" data-v-12b68786>  }
</span>`</code></pre></div><div class="saber-highlight" data-lang="diff" data-v-12b68786><pre class="saber-highlight-code language-diff" data-v-12b68786><code class="language-diff" data-v-12b68786>const resolvers = {
<span class="token unchanged" data-v-12b68786>  Query: {
    async postsWithMeta(root, args) {
      const {
        page, limit
      } = args
      const res = await http.get('/posts', {
        params: {
</span><span class="token inserted-sign inserted" data-v-12b68786>+         _page: page,
</span><span class="token unchanged" data-v-12b68786>          _limit: limit
        }
      })
      return {
</span><span class="token inserted-sign inserted" data-v-12b68786>+       metadata: {
+         total: res.headers['x-total-count']
+       },
+       data: res.data
</span><span class="token unchanged" data-v-12b68786>      }
    }
  },
</span>}</code></pre></div><p data-v-12b68786>前端就可以传 <code data-v-12b68786>limit</code> 和 <code data-v-12b68786>page</code> 实现分页：</p> <div class="saber-highlight" data-lang="javascript" data-v-12b68786><pre class="saber-highlight-code language-javascript" data-v-12b68786><code class="language-javascript" data-v-12b68786><span class="token keyword" data-v-12b68786>const</span> <span class="token constant" data-v-12b68786>GET_POSTS</span> <span class="token operator" data-v-12b68786>=</span> gql<span class="token template-string" data-v-12b68786><span class="token template-punctuation string" data-v-12b68786>`</span><span class="token string" data-v-12b68786>
  query GetPosts($limit: Int!, $page: Int) {
    postsWithMeta(limit: $limit, page: $page) {
      metadata {
        total
      },

      data {
        id, title
      }
    } 
  }
</span><span class="token template-punctuation string" data-v-12b68786>`</span></span><span class="token punctuation" data-v-12b68786>;</span>

<span class="token keyword" data-v-12b68786>export</span> <span class="token keyword" data-v-12b68786>default</span> <span class="token keyword" data-v-12b68786>class</span> <span class="token class-name" data-v-12b68786>Pagination</span> <span class="token keyword" data-v-12b68786>extends</span> <span class="token class-name" data-v-12b68786>React<span class="token punctuation" data-v-12b68786>.</span>Component</span> <span class="token punctuation" data-v-12b68786>{</span>

  <span class="token comment" data-v-12b68786>// 传给 Ant.Design Table 的 pagination 信息</span>
  state <span class="token operator" data-v-12b68786>=</span> <span class="token punctuation" data-v-12b68786>{</span>
    pagination<span class="token punctuation" data-v-12b68786>:</span> <span class="token punctuation" data-v-12b68786>{</span>
      pageSize<span class="token punctuation" data-v-12b68786>:</span> <span class="token number" data-v-12b68786>10</span><span class="token punctuation" data-v-12b68786>,</span>
      current<span class="token punctuation" data-v-12b68786>:</span> <span class="token number" data-v-12b68786>1</span><span class="token punctuation" data-v-12b68786>,</span>
      total<span class="token punctuation" data-v-12b68786>:</span> <span class="token number" data-v-12b68786>0</span>
    <span class="token punctuation" data-v-12b68786>}</span>
  <span class="token punctuation" data-v-12b68786>}</span><span class="token punctuation" data-v-12b68786>;</span>

  <span class="token comment" data-v-12b68786>// Query 完成后，给 pagination 设置数据总数</span>
  <span class="token function-variable function" data-v-12b68786>onCompleteQuery</span> <span class="token operator" data-v-12b68786>=</span> <span class="token punctuation" data-v-12b68786>(</span><span class="token parameter" data-v-12b68786><span class="token punctuation" data-v-12b68786>{</span>
    postsWithMeta<span class="token punctuation" data-v-12b68786>:</span> <span class="token punctuation" data-v-12b68786>{</span>
      metadata<span class="token punctuation" data-v-12b68786>:</span> <span class="token punctuation" data-v-12b68786>{</span> total <span class="token punctuation" data-v-12b68786>}</span>
    <span class="token punctuation" data-v-12b68786>}</span>
  <span class="token punctuation" data-v-12b68786>}</span></span><span class="token punctuation" data-v-12b68786>)</span> <span class="token operator" data-v-12b68786>=&gt;</span> <span class="token punctuation" data-v-12b68786>{</span>
    <span class="token keyword" data-v-12b68786>const</span> pagination <span class="token operator" data-v-12b68786>=</span> <span class="token punctuation" data-v-12b68786>{</span> <span class="token operator" data-v-12b68786>...</span>this<span class="token punctuation" data-v-12b68786>.</span>state<span class="token punctuation" data-v-12b68786>.</span>pagination <span class="token punctuation" data-v-12b68786>}</span><span class="token punctuation" data-v-12b68786>;</span>
    pagination<span class="token punctuation" data-v-12b68786>.</span>total <span class="token operator" data-v-12b68786>=</span> total<span class="token punctuation" data-v-12b68786>;</span>
    <span class="token keyword" data-v-12b68786>this</span><span class="token punctuation" data-v-12b68786>.</span><span class="token function" data-v-12b68786>setState</span><span class="token punctuation" data-v-12b68786>(</span><span class="token punctuation" data-v-12b68786>{</span> pagination <span class="token punctuation" data-v-12b68786>}</span><span class="token punctuation" data-v-12b68786>)</span><span class="token punctuation" data-v-12b68786>;</span>
  <span class="token punctuation" data-v-12b68786>}</span><span class="token punctuation" data-v-12b68786>;</span>

  <span class="token function-variable function" data-v-12b68786>handleTableChange</span> <span class="token operator" data-v-12b68786>=</span> <span class="token parameter" data-v-12b68786>pagination</span> <span class="token operator" data-v-12b68786>=&gt;</span> <span class="token punctuation" data-v-12b68786>{</span>
    <span class="token keyword" data-v-12b68786>const</span> pager <span class="token operator" data-v-12b68786>=</span> <span class="token punctuation" data-v-12b68786>{</span> <span class="token operator" data-v-12b68786>...</span>pagination <span class="token punctuation" data-v-12b68786>}</span><span class="token punctuation" data-v-12b68786>;</span>
    pager<span class="token punctuation" data-v-12b68786>.</span>current <span class="token operator" data-v-12b68786>=</span> pagination<span class="token punctuation" data-v-12b68786>.</span>current<span class="token punctuation" data-v-12b68786>;</span>
    <span class="token keyword" data-v-12b68786>this</span><span class="token punctuation" data-v-12b68786>.</span><span class="token function" data-v-12b68786>setState</span><span class="token punctuation" data-v-12b68786>(</span><span class="token punctuation" data-v-12b68786>{</span> pagination <span class="token punctuation" data-v-12b68786>}</span><span class="token punctuation" data-v-12b68786>)</span><span class="token punctuation" data-v-12b68786>;</span>
  <span class="token punctuation" data-v-12b68786>}</span><span class="token punctuation" data-v-12b68786>;</span>

  <span class="token function" data-v-12b68786>render</span><span class="token punctuation" data-v-12b68786>(</span><span class="token punctuation" data-v-12b68786>)</span> <span class="token punctuation" data-v-12b68786>{</span>
    <span class="token keyword" data-v-12b68786>return</span> <span class="token punctuation" data-v-12b68786>(</span>
      <span class="token operator" data-v-12b68786>&lt;</span>div style<span class="token operator" data-v-12b68786>=</span><span class="token punctuation" data-v-12b68786>{</span><span class="token punctuation" data-v-12b68786>{</span> padding<span class="token punctuation" data-v-12b68786>:</span> <span class="token string" data-v-12b68786>&quot;2rem&quot;</span> <span class="token punctuation" data-v-12b68786>}</span><span class="token punctuation" data-v-12b68786>}</span><span class="token operator" data-v-12b68786>&gt;</span>
        <span class="token operator" data-v-12b68786>&lt;</span>Query
          onCompleted<span class="token operator" data-v-12b68786>=</span><span class="token punctuation" data-v-12b68786>{</span><span class="token keyword" data-v-12b68786>this</span><span class="token punctuation" data-v-12b68786>.</span>onCompleteQuery<span class="token punctuation" data-v-12b68786>}</span>
          query<span class="token operator" data-v-12b68786>=</span><span class="token punctuation" data-v-12b68786>{</span><span class="token constant" data-v-12b68786>GET_POSTS</span><span class="token punctuation" data-v-12b68786>}</span>
          variables<span class="token operator" data-v-12b68786>=</span><span class="token punctuation" data-v-12b68786>{</span><span class="token punctuation" data-v-12b68786>{</span>
            <span class="token comment" data-v-12b68786>// 在 pagination 信息中得到 `limit` 和 `page`</span>
            limit<span class="token punctuation" data-v-12b68786>:</span> <span class="token keyword" data-v-12b68786>this</span><span class="token punctuation" data-v-12b68786>.</span>state<span class="token punctuation" data-v-12b68786>.</span>pagination<span class="token punctuation" data-v-12b68786>.</span>pageSize<span class="token punctuation" data-v-12b68786>,</span>
            page<span class="token punctuation" data-v-12b68786>:</span> <span class="token keyword" data-v-12b68786>this</span><span class="token punctuation" data-v-12b68786>.</span>state<span class="token punctuation" data-v-12b68786>.</span>pagination<span class="token punctuation" data-v-12b68786>.</span>current
          <span class="token punctuation" data-v-12b68786>}</span><span class="token punctuation" data-v-12b68786>}</span>
        <span class="token operator" data-v-12b68786>&gt;</span>
          <span class="token punctuation" data-v-12b68786>{</span><span class="token punctuation" data-v-12b68786>(</span><span class="token parameter" data-v-12b68786><span class="token punctuation" data-v-12b68786>{</span> loading<span class="token punctuation" data-v-12b68786>,</span> data <span class="token punctuation" data-v-12b68786>}</span></span><span class="token punctuation" data-v-12b68786>)</span> <span class="token operator" data-v-12b68786>=&gt;</span> <span class="token punctuation" data-v-12b68786>{</span>
            <span class="token keyword" data-v-12b68786>const</span> columns <span class="token operator" data-v-12b68786>=</span> <span class="token punctuation" data-v-12b68786>[</span>
              <span class="token punctuation" data-v-12b68786>{</span>
                title<span class="token punctuation" data-v-12b68786>:</span> <span class="token string" data-v-12b68786>&quot;ID&quot;</span><span class="token punctuation" data-v-12b68786>,</span>
                dataIndex<span class="token punctuation" data-v-12b68786>:</span> <span class="token string" data-v-12b68786>&quot;id&quot;</span>
              <span class="token punctuation" data-v-12b68786>}</span><span class="token punctuation" data-v-12b68786>,</span>
              <span class="token punctuation" data-v-12b68786>{</span> title<span class="token punctuation" data-v-12b68786>:</span> <span class="token string" data-v-12b68786>&quot;Title&quot;</span><span class="token punctuation" data-v-12b68786>,</span> dataIndex<span class="token punctuation" data-v-12b68786>:</span> <span class="token string" data-v-12b68786>&quot;title&quot;</span> <span class="token punctuation" data-v-12b68786>}</span>
            <span class="token punctuation" data-v-12b68786>]</span><span class="token punctuation" data-v-12b68786>;</span>

            <span class="token keyword" data-v-12b68786>const</span> dataSource <span class="token operator" data-v-12b68786>=</span> data<span class="token punctuation" data-v-12b68786>.</span>postsWithMeta <span class="token operator" data-v-12b68786>?</span> data<span class="token punctuation" data-v-12b68786>.</span>postsWithMeta<span class="token punctuation" data-v-12b68786>.</span>data <span class="token punctuation" data-v-12b68786>:</span> <span class="token punctuation" data-v-12b68786>[</span><span class="token punctuation" data-v-12b68786>]</span><span class="token punctuation" data-v-12b68786>;</span>

            <span class="token keyword" data-v-12b68786>return</span> <span class="token punctuation" data-v-12b68786>(</span>
              <span class="token operator" data-v-12b68786>&lt;</span>Table
                pagination<span class="token operator" data-v-12b68786>=</span><span class="token punctuation" data-v-12b68786>{</span><span class="token keyword" data-v-12b68786>this</span><span class="token punctuation" data-v-12b68786>.</span>state<span class="token punctuation" data-v-12b68786>.</span>pagination<span class="token punctuation" data-v-12b68786>}</span>
                onChange<span class="token operator" data-v-12b68786>=</span><span class="token punctuation" data-v-12b68786>{</span><span class="token keyword" data-v-12b68786>this</span><span class="token punctuation" data-v-12b68786>.</span>handleTableChange<span class="token punctuation" data-v-12b68786>}</span>
                rowKey<span class="token operator" data-v-12b68786>=</span><span class="token punctuation" data-v-12b68786>{</span><span class="token parameter" data-v-12b68786>record</span> <span class="token operator" data-v-12b68786>=&gt;</span> record<span class="token punctuation" data-v-12b68786>.</span>id<span class="token punctuation" data-v-12b68786>}</span>
                size<span class="token operator" data-v-12b68786>=</span><span class="token string" data-v-12b68786>&quot;small&quot;</span>
                loading<span class="token operator" data-v-12b68786>=</span><span class="token punctuation" data-v-12b68786>{</span>loading<span class="token punctuation" data-v-12b68786>}</span>
                dataSource<span class="token operator" data-v-12b68786>=</span><span class="token punctuation" data-v-12b68786>{</span>dataSource<span class="token punctuation" data-v-12b68786>}</span>
                columns<span class="token operator" data-v-12b68786>=</span><span class="token punctuation" data-v-12b68786>{</span>columns<span class="token punctuation" data-v-12b68786>}</span>
              <span class="token operator" data-v-12b68786>/</span><span class="token operator" data-v-12b68786>&gt;</span>
            <span class="token punctuation" data-v-12b68786>)</span><span class="token punctuation" data-v-12b68786>;</span>
          <span class="token punctuation" data-v-12b68786>}</span><span class="token punctuation" data-v-12b68786>}</span>
        <span class="token operator" data-v-12b68786>&lt;</span><span class="token operator" data-v-12b68786>/</span>Query<span class="token operator" data-v-12b68786>&gt;</span>
      <span class="token operator" data-v-12b68786>&lt;</span><span class="token operator" data-v-12b68786>/</span>div<span class="token operator" data-v-12b68786>&gt;</span>
    <span class="token punctuation" data-v-12b68786>)</span><span class="token punctuation" data-v-12b68786>;</span>
  <span class="token punctuation" data-v-12b68786>}</span>
<span class="token punctuation" data-v-12b68786>}</span></code></pre></div><p data-v-12b68786><a rel="noopener noreferrer" target="_blank" href="https://codesandbox.io/s/pwmrnjz2km?initialpath=%2Ftable%2Fpagination&amp;module=%2Fchapters%2FTable%2Fpagination.tsx" data-v-12b68786><img src="https://codesandbox.io/static/img/play-codesandbox.svg#alt=Edit%20effective-apollo-antd" alt="" data-v-12b68786></a></p> <h2 id="whats-next" data-v-12b68786>What's next</h2> <p data-v-12b68786>GraphQL 比 RESTful 的优势在于，GraphQL 让你专注于你想做什么，想获取什么。「查询语言」是声明式的，而「HTTP 请求」是命令式的。声明式可以让复杂度转移给运行时，就像 GraphQL 语句最终执行的 HTTP 请求可以交给像 Apollo 这样的封装去处理。</p> <p data-v-12b68786>当你不再需要自己管理这么多 HTTP 请求的状态时，你就要仔细考虑你的应用到底需不需要状态管理工具了。尤其在开发中后台类的管理系统应用时，往往不会涉及复杂的数据流。<a rel="noopener noreferrer" target="_blank" href="https://medium.com/@dan_abramov/you-might-not-need-redux-be46360cf367" data-v-12b68786>Local state is fine</a>.</p></div></div> <div class="post text-center text-sm" data-v-12b68786><hr class="mt-12 mb-12" data-v-12b68786> <p data-v-12b68786>讨论请发邮件到 randypriv@gmail.com</p> <p data-v-12b68786>未经授权，禁止转载</p> <p data-v-12b68786>通过支付宝 djyde520@gmail.com 或赞赏码赞助此文</p> <p data-v-12b68786>
      或通过订阅我的
      <a href="/blog/my-zsxq/" data-v-12b68786 data-v-12b68786>知识星球</a>支持本博客
    </p> <br data-v-12b68786> <p data-v-12b68786><img src="https://gbstatic.djyde.com/assets/006tKfTcgy1fkuufy2cadj30w00w0tb2.jpg" class="w-auto sm:w-64 mx-auto" data-v-12b68786></p></div></div> <div class="font-serif text-sm text-center p-12 sm:p-32 text-gray-500 font-bold"><div>
      2014-2019
      <a href="/" class="router-link-active">Randy's Blog</a></div> <div class="mt-2">
      可通過
      <a href="/rss.xml" class="border-b-4">RSS</a> 或
      <a rel="noopener noreferrer" target="_blank" href="https://tinyletter.com/randysblog" class="border-b-4">Email</a> 訂閱本博客
    </div></div></div></div><script src="/_saber/js/styles.2c5e9edc.js" defer></script><script src="/_saber/js/page--_posts-effective-graphql-and-antd-md.8573df0c.js" defer></script><script src="/_saber/js/client.4d7c860d.js" defer></script></body></html>
